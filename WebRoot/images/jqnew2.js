if(typeof(Array.prototype.push)!="function"){Array.prototype.push=function(){for(var a=0;a<arguments.length;a++){this[this.length]=arguments[a];}return this.length;};}String.prototype.format=function(){var a=arguments;return this.replace(/\{(\d+)\}/g,function(b,c){return a[c];});};String.prototype.dbc2sbc=function(){return this.replace(/[\uff01-\uff5e]/g,function(b){return String.fromCharCode(b.charCodeAt(0)-65248);}).replace(/\u3000/g," ");};var hasAnswer=false;var hrefSave=document.getElementById("hrefSave");var cur_page=0;var jumpPages;var pageHolder=new Array();var trapHolder=new Array();var totalQ=0;var completeLoaded=false;var MaxTopic=0;if(displayPrevPage=="none"&&(hasJoin=="1"||isSuper)){displayPrevPage="";}var curdiv=null;var curfilediv=null;var isUploadingFile=false;var hasZhenBiePage=false;var progressArray=new Object();var questionsObject=new Object();var joinedTopic=0;var randomparm="";var hasTouPiao=false;var useSelfTopic=false;var isChrome=window.chrome;document.oncontextmenu=document.ondragstart=document.onselectstart=avoidCopy;var ZheZhaoControl=null;function forbidBackSpace(f){var c=f||window.event;var d=c.target||c.srcElement;var b=d.type||d.getAttribute("type");var a=c.keyCode==8&&b!="password"&&b!="text"&&b!="textarea";if(a){return false;}}document.onkeydown=forbidBackSpace;function avoidCopy(b){b=window.event||b;var a;if(b){if(b.target){a=b.target;}else{if(b.srcElement){a=b.srcElement;}}if(a.nodeType==3){a=a.parentNode;}if(a.tagName=="INPUT"||a.tagName=="TEXTAREA"||a.tagName=="SELECT"){return true;}}if(document.selection&&document.selection.empty){document.selection.empty();}return false;}function showItemDesc(b,a){var d=document.getElementById(b);var e=document.getElementById("divDescPopData");e.innerHTML=d.innerHTML;var c=trim(d.innerHTML);if(c.indexOf("http")==0){PDF_launch(c.replace(/&amp;/g,"&"),800,600);}else{PDF_launch("divDescPop",500,500);}}var needCheckLeave=true;if(allowSaveJoin&&isRunning=="true"&&guid){window.onunload=function(){if(needCheckLeave){if(confirm("您要保存填写的答卷吗？")){submit(2);alert("答卷保存成功！");}}};}$=function(a){return document.getElementById(a);};$$=function(a,b){if(b){return b.getElementsByTagName(a);}else{return document.getElementsByTagName(a);}};function getTop(b){var a=b.offsetLeft;var c=b.offsetTop;while(b=b.offsetParent){a+=b.offsetLeft;c+=b.offsetTop;}return{x:a,y:c};}function addEventSimple(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false);}else{if(c.attachEvent){c.attachEvent("on"+a,b);}}}function removeEventSimple(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false);}else{if(c.detachEvent){c.detachEvent("on"+a,b);}}}function Request(d){var b=window.document.location.href;var f=b.indexOf("?");var e=b.substr(f+1);var c=e.split("&");for(var a=0;a<c.length;a++){var g=c[a].split("=");if(g[0].toUpperCase()==d.toUpperCase()){return g[1];}}return"";}var txtCurCity=null;function openCityBox(g,f,d,h){txtCurCity=g;if(g.getAttribute("lastdata")=="1"){txtCurCity.lastData=1;}ZheZhaoControl=txtCurCity;h=h||"";var b=g.getAttribute("province");var c="";if(b){c="&pv="+encodeURIComponent(b);}if(f==3){PDF_launch("/wjx/design/setcitycounty.aspx?activityid="+activityId+"&ct="+f+c+"&pos="+h,450,220);}else{if(f==5){PDF_launch("/wjx/design/setmenuselp.aspx?activityid="+activityId+"&ct="+f+"&pos="+h,470,220);}else{if(f==6){ZheZhaoControl=null;var e="/wjx/join/amap.aspx?activityid="+activityId+"&ct="+f+"&pos="+h;var a=document.documentElement.clientHeight||document.body.clientHeight;if(g.parent&&g.parent.dataNode._needOnly){e+="&nc=1";if(g.value){writeError(g.parent,"提示：定位后无法修改。",0,true);return;}}PDF_launch(e,700,800);}else{if(f==4){ZheZhaoControl=null;PDF_launch("/wjx/design/school.aspx?activityid="+activityId+c,700,440);}else{PDF_launch("/wjx/design/setcity.aspx?activityid="+activityId+"&ct="+f+"&pos="+h,470,220);}}}}}function setChoice(b){var a=getPreviousNode(b);if(a){a.value=b.value;}if(curdiv){updateProgressBar(curdiv.dataNode);}}function setCityBox(c){txtCurCity.value=c;if(txtCurCity.parentNode.tagName=="TD"){txtCurCity.title=c;return;}var a=txtCurCity.offsetWidth;var b=c.length*13;if(b>a){txtCurCity.style.width=b+"px";}}var submit_tip=document.getElementById("submit_tip");var submit_div=document.getElementById("submit_div");function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"");}function isInt(a){var b=/^-?[0-9]+$/;return b.test(a);}var spChars=["$","}","^","|","<"];var spToChars=["ξ","｝","ˆ","¦","&lt;"];function replace_specialChar(c){for(var a=0;a<spChars.length;a++){var b=new RegExp("(\\"+spChars[a]+")","g");c=c.replace(b,spToChars[a]);}if(/^[A-Za-z\s]+$/.test(c)){c=c.replace(/\s+/g," ");}c=c.replace(/[^\x09\x0A\x0D\x20-\uD7FF\uE000-\uFFFD\u10000-\u10FFFF]/ig,"");return trim(c);}function isRadioImage(a){if(!a||a=="0"||a=="1"||a=="101"){return false;}else{return true;}}function isRadioRate(a){return a!=""&&a!="0"&&a!="1"&&a!="-1";}var submit_table=document.getElementById("submit_table");var pre_page=document.getElementById("btnPre");var next_page=document.getElementById("btnNext");var submit_button=document.getElementById("submit_button");var imgCode=document.getElementById("imgCode");var submit_text=document.getElementById("yucinput");var tCode=document.getElementById(tdCode);var divMinTime=document.getElementById("divMinTime");var spanMinTime=document.getElementById("spanMinTime");var divMaxTime=document.getElementById("divMaxTime");var spanMaxTime=document.getElementById("spanMaxTime");var maxCounter=0;var maxTimer=null;var minTimer=null;var initMaxSurveyTime=0;function changeHeight(d){var e=parseInt(d.style.height);if(!e){return;}if(!d.initHeight){d.initHeight=e;}var c=18;var b=100;var a=d.scrollHeight;a=a>c?a:c;a=a>b?b:a;if(a-e>=10){d.style.height=a+"px";}if(!d.value||d.value.length<5){d.style.height=d.initHeight+"px";}}function fcInputboxFocus(){}function lengthChange(c){var a=c.value.length;var b=c.size;if(a>=b&&b<=80){c.size=a+2;}else{if(b>80){}}}function fcInputboxBlur(){if(!this.value){this.value=defaultOtherText;this.style.color="#999999";}else{this.style.color="#000000";if(langVer!=0){return;}if(this.tagName=="select"){return;}var e=this.parent;var c=e.itemInputs;var f=this.value.split(/(,|，)/ig);for(var d=0;d<c.length;d++){var b=getNextNode(c[d]);if(!b){return;}for(var a=0;a<f.length;a++){if(trim(f[a].toLowerCase())==trim(b.innerHTML.toLowerCase())){alert("提示：您输入的“"+f[a]+"”已经包含在题目选项当中");c[d].click();b.style.color="red";if(f.length==1&&this.choiceRel&&this.choiceRel.checked){this.value="";this.choiceRel.click();}}}}}}function isTextBoxEmpty(a){a=trim(a);if(a==""||a==defaultOtherText){return true;}return false;}var curMatrixFill=null;var curMatrixError=null;var divMatrixRel=document.getElementById("divMatrixRel");var matrixinput=document.getElementById("matrixinput");function setMatrixFill(){if(curMatrixError&&!curMatrixFill.fillvalue){return;}divMatrixRel.style.display="none";}function showMatrixFill(e,g){if(g){if(curMatrixError){return;}curMatrixError=e;}curMatrixFill=e;var f="请注明...";var h=e.getAttribute("req");if(h){f="请注明...[必填]";}var d=e.fillvalue||e.getAttribute("fillvalue")||"";matrixinput.value=d;if(!d){matrixinput.value=f;}var b=getPreviousNode(e);var c=getTop(b);var i=c.y-35;var a=c.x-190;divMatrixRel.style.top=i+"px";divMatrixRel.style.left=a+"px";divMatrixRel.style.display="";}divMatrixRel.onclick=function(a){if(curMatrixFill){var b=curMatrixFill.parent.parent;if(b&&b.removeError){b.removeError();}}stopPropa(a);};matrixinput.onkeyup=matrixinput.onblur=matrixinput.onfocus=function(a){if(curMatrixFill){var b=this.value;if(b.indexOf("请注明...")==0){this.value=b="";}curMatrixFill.fillvalue=trim(b);}};function refresh_validate(){if(imgCode&&tCode.style.display!="none"&&imgCode.style.display!="none"){imgCode.src="/AntiSpamImageGen.aspx?q="+activityId+"&t="+(new Date()).valueOf();}}function enter_clicksub(a){a=a||window.event;if(a&&a.keyCode==13){submit(1);}}var relationHT=new Array();var relationQs=new Object();var relationNotDisplayQ=new Object();var nextPageAlertText="";var hasMaxtime=false;var imgVerify=null;var shopHT=new Array();Init();function Init(){if(cur_page==0&&!displayPrevPage&&pre_page){pre_page.style.display="none";pre_page.disabled=true;}pageHolder=$$("fieldset",survey);for(var M=0;M<pageHolder.length;M++){var af=pageHolder[M].getAttribute("skip")=="true";if(af){pageHolder[M].skipPage=true;}}submit_button.onmouseover=function(){this.className="submitbutton submitbutton_hover";if(isPub&&document.getElementById("spanTest").style.display!=""){document.getElementById("spanTest").style.display="";document.getElementById("submittest_button").onmouseover=function(){show_status_tip("您是发布者，可以进行试填问卷，试填的答卷不会参与结果统计！",5000);document.getElementById("submittest_button").onmouseover=null;};}};submit_button.onclick=function(){if(checkDisalbed()){return;}submit(1);};if(isPub){document.getElementById("submittest_button").onclick=function(){if(confirm("试填后的答卷不会参与结果统计，确定试填吗？")){submit(5);}};}if(hasJoin=="3"){submit_button.onclick=function(){if(checkDisalbed()){return;}if(window.confirm("确定编辑此答卷吗？")){submit(6);}};}if(totalPage==1&&isRunning=="true"&&hasJoin!="1"){submit_table.style.display="";}else{if(isRunning!="true"){var ap=document.getElementById("spanNotSubmit");if(ap&&trim(ap.innerHTML)!=""){if(totalPage==1&&hasJoin!="1"){submit_table.style.display="";}nextPageAlertText=ap.innerHTML.replace(/<[^>]*>/g,"");submit_button.onclick=function(){if(checkDisalbed()){return;}alert(nextPageAlertText);ap.scrollIntoView();};}else{submit_table.style.display="none";}}else{submit_table.style.display="none";}}if(pre_page){pre_page.onclick=show_pre_page;}if(next_page){next_page.onclick=show_next_page;}if(tCode&&tCode.style.display!="none"&&isRunning=="true"){submit_text.value=validate_info_submit_title3;addEventSimple(submit_text,"blur",function(){if(submit_text.value==""){submit_text.value=validate_info_submit_title3;}});addEventSimple(submit_text,"focus",function(){if(submit_text.value==validate_info_submit_title3){submit_text.value="";}});imgCode.style.display="none";if(langVer!=0){imgCode.alt="";}addEventSimple(submit_text,"click",function(){if(!needAvoidCrack&&imgCode.style.display=="none"){imgCode.style.display="";imgCode.onclick=refresh_validate;imgCode.onclick();imgCode.title=validate_info_submit_title1;}else{if(needAvoidCrack&&!imgVerify){var q=document.getElementById("divCaptcha");q.style.display="";imgVerify=q.getElementsByTagName("img")[0];imgVerify.style.cursor="pointer";imgVerify.onclick=function(){var aF=new Date();var aa=aF.getTime()+(aF.getTimezoneOffset()*60000);var aD=window.location.host||"www.sojump.com";var aE="//"+aD+"/BotDetectCaptcha.ashx?activity="+activityId+"&get=image&c="+this.captchaId+"&t="+this.instanceId+"&d="+aa;this.src=aE;};var i=imgVerify.getAttribute("captchaid");var k=imgVerify.getAttribute("instanceid");imgVerify.captchaId=i;imgVerify.instanceId=k;imgVerify.onclick();}}});}for(var K=0;K<pageHolder.length;K++){var V=$$("div",pageHolder[K]);if(hasJoin){pageHolder[K].style.display="";}var ai=new Array();var w=new Array();var F=0;for(var M=0;M<V.length;M++){var f=V[M].className.toLowerCase();if(f=="div_question"){var aB=V[M].getAttribute("istrap")=="1";V[M].onclick=divQuestionClick;if(aB){V[M].isTrap=true;trapHolder.push(V[M]);initItem(V[M]);V[M].pageIndex=K+1;}else{V[M].indexInPage=F;ai[F]=V[M];ai[F].pageIndex=K+1;F++;totalQ++;}}else{if(V[M].id&&V[M].id.indexOf("divCut")==0){w.push(V[M]);}}}pageHolder[K].questions=ai;pageHolder[K].cuts=w;}set_data_fromServer(qstr);var O=new Array();for(var ag=0;ag<pageHolder.length;ag++){var b=pageHolder[ag].questions;for(var M=0;M<b.length;M++){var m=b[M].dataNode;var S=m._type;var av=b[M].getAttribute("relation");var a=b[M].getAttribute("isshop");if(a=="1"){b[M].isShop=true;shopHT.push(b[M]);}if(av&&av!="0"){var l=av.split(",");var X=l[0];var ar=l[1].split(";");for(var au=0;au<ar.length;au++){var y=X+","+ar[au];if(!relationHT[y]){relationHT[y]=new Array();}relationHT[y].push(b[M]);}if(!relationQs[X]){relationQs[X]=new Array();}relationQs[X].push(b[M]);relationNotDisplayQ[m._topic]="1";}else{if(av=="0"){relationNotDisplayQ[m._topic]="1";}}if(S!="page"&&S!="cut"){questionsObject[m._topic]=b[M];}var d=b[M].getAttribute("titletopic");if(d){var ah=questionsObject[d];if(ah){if(!ah.dataNode._titleTopic){ah.dataNode._titleTopic=new Array();}ah.dataNode._titleTopic.push(m._topic);var Q=document.getElementById("divTitle"+m._topic);if(Q){Q.innerHTML=Q.innerHTML.replace("[q"+d+"]","<span id='spanTitleTopic"+m._topic+"' style='text-decoration:underline;'></span>");}}}if(b[M].getAttribute("hrq")=="1"){continue;}if(S=="radio"||S=="check"){if(S=="radio"&&isRadioImage(m._mode)){initLikertItem(b[M]);}else{initItem(b[M]);}}if(S=="fileupload"){var aq=$$("iframe",b[M]);if(aq&&aq[0]){b[M].uploadFrame=aq[0];b[M].uploadFrame.allowTransparency=true;var U=document.frames?document.frames[aq[0].id]:document.getElementById(aq[0].id).contentWindow;U.curdiv=b[M];U._ext=m._ext;}var V=$$("div",b[M]);for(var L=0;L<V.length;L++){if(V[L].className.toLowerCase()=="uploadmsg"){b[M].uploadmsg=V[L];V[L].style.color="red";break;}}b[M].uploadFinish=function(i,q){this.uploadmsg.innerHTML=i;this.fileName=q;isUploadingFile=false;this.uploadFrame.style.display="";var k=document.frames?document.frames[this.uploadFrame.id]:document.getElementById(this.uploadFrame.id).contentWindow;k.curdiv=this;k._ext=this.dataNode._ext;updateProgressBar(this.dataNode);jump(this,this.uploadFrame);};}if(S=="matrix"){var Y=m._mode;if(m._hasjump){if(Y&&Y-100<0){initLikertItem(b[M]);}else{initItem(b[M]);}}var ay=b[M].getAttribute("DaoZhi");var an=null;if(!ay){an=$$("tr",b[M]);}else{var t=$$("tr",b[M]);an=new Array();var G=t[0].cells.length-1;for(var p=0;p<G;p++){an[p]=t[0].cells[p+1];an[p].itemInputs=new Array();}for(var p=0;p<G;p++){for(var am=0;am<t.length;am++){var v=t[am].cells[p+1];v.parent=an[p];v.onclick=function(){if(curMatrixItem!=this.parent){var k=this.parent.itemInputs;if(k){for(var q=0;q<k.length;q++){k[q].parentNode.style.background="#edfafe";}}if(curMatrixItem&&curMatrixItem.daoZhi){k=curMatrixItem.itemInputs;for(var q=0;q<k.length;q++){k[q].parentNode.style.background="";}}divMatrixItemClick.call(this.parent);}var i=this.parent.parent.dataNode;if(i._maxvalue){i._maxValue=i._maxvalue;}if(i._minvalue){i._minValue=i._minvalue;}checkMinMax(this.getElementsByTagName("input")[0],this.parent.parent.dataNode,this.parent);};an[p].parent=b[M];an[p].daoZhi=true;var n=v.getElementsByTagName("input")[0];if(n){an[p].itemInputs.push(n);}}}}if(!ay){for(var L=0;L<an.length;L++){if(Y!="303"){var T=an[L].style.display=="none";if(!T){if(Y&&Y-100<0){initLikertItem(an[L]);}else{if(!ay){initItem(an[L]);}}}}else{var D=$$("select",an[L]);if(D.length>0){an[L].itemSels=D;}if(m._hasjump){for(var ao=0;ao<D.length;ao++){D[ao].parent=an[L];D[ao].onchange=function(){var aE=this.parent.parent;var aD=aE.itemTrs;var aa=false;for(var k=0;k<aD.length;k++){var q=aD[k].itemSels;if(!q){continue;}for(var i=0;i<q.length;i++){if(q[i].value){aa=true;break;}}if(aa){break;}}jumpAny(aa,aE);};}}}an[L].parent=b[M];an[L].onclick=divMatrixItemClick;}}if(Y=="301"||Y=="102"){var ad=b[M].getAttribute("minvalue");var Z=b[M].getAttribute("maxvalue");b[M].dataNode._minvalue=ad;b[M].dataNode._maxvalue=Z;if(Y=="301"){b[M].dataNode._verify="数字";if(b[M].getAttribute("digittype")=="1"){b[M].dataNode._verify="小数";}b[M].dataNode._minword=ad;b[M].dataNode._maxword=Z;var P=$$("textarea",b[M]);for(var L=0;L<P.length;L++){P[L].parent=b[M];P[L].onblur=function(){txtChange(this);};}}}else{if(Y=="302"){var P=$$("textarea",b[M]);for(var L=0;L<P.length;L++){P[L].parent=b[M];P[L].onblur=function(){var k=this.parent;if(k.removeError){k.removeError();}var i=validateMatrix(k.dataNode,this,this);if(i){k.errorControl=this;writeError(k,verifyMsg,3000);}};}}}if(an.length>0){b[M].itemTrs=an;}}if(S=="sum"){initItem(b[M]);var an=$$("tr",b[M]);var C=new Array();for(var L=0;L<an.length;L++){var e=an[L].getAttribute("rowid");if(e){an[L].parent=b[M];C.push(an[L]);}}var R=b[M].itemInputs.length;var c=b[M].itemInputs;for(var L=0;L<R;L++){c[L].onblur=function(){txtChange(this);};}if(C.length>0){b[M].itemTrs=C;}var H=b[M].getAttribute("rel");b[M].relSum=document.getElementById(H);}if(S=="check"&&m.isSort){var N=$$("a",b[M]);for(L=0;L<N.length;L++){N[L].onclick=itemSortClick;}}if(S=="question"){var B=$$("textarea",b[M]);if(B.length>0){B[0].onkeyup=function(){txtChange(this);referTitle(this.parent,this.value);};if(!B[0].onclick){B[0].onclick=B[0].onkeyup;}B[0].onblur=B[0].onchange=function(){txtChange(this,1);referTitle(this.parent,this.value);};B[0].parent=b[M];b[M].itemTextarea=B[0];if(B[1]){var E=getPreviousNode(B[1]);E.par=b[M];B[1].par=b[M];b[M].needsms=true;b[M].mobileinput=B[0];b[M].verifycodeinput=B[1];if(B[2]){E.txtCode=B[2];}E.onclick=function(){if(this.disabled){return;}var k=this.par;if(!/^\d{11}$/.test(k.mobileinput.value)){alert("请输入正确的手机号码");return;}if(k.issmsvalid&&k.mobile==k.mobileinput.value){return;}if(this.isSending){return;}if(!E.txtCode){return;}if(this.repeat&&!confirm("您输入的手机号码“"+k.mobileinput.value+"”确认准确无误吗？")){return;}var aa="divVCode"+k.dataNode._topic;var q=document.getElementById(aa);PDF_launch(aa,300,70);var aD=q.getElementsByTagName("textarea")[0];var i=q.getElementsByTagName("img")[0];if(i.style.display=="none"){i.onclick=function(){this.src="/AntiSpamImageGen.aspx?t="+(new Date()).valueOf();};i.style.display="";i.onclick();}else{i.onclick();}aD.onkeyup=aD.onblur=function(){var aE=/^[0-9a-zA-Z]{4}$/g;if(aE.test(this.value)){E.sendActivitySms(this.value);this.value="";PDF_close();}};aD.focus();};E.sendActivitySms=function(aa){this.isSending=true;this.disabled=true;var q=this.par;var i=this;var k=getXmlHttp();k.onreadystatechange=function(){if(k.readyState!=4){return;}if(k.status!=200){return;}var aE=k.responseText;var aF="";var aD=false;if(aE=="true"){aF="成功发送，每天最多发送5次。如未收到，请检查手机号是否正确！";aD=true;i.repeat=true;i.resent();}else{if(aE=="fast"){aF="发送频率过快";i.resent();}else{if(aE=="no"){aF="发布者短信数量不够";}else{if(aE=="fail"){aF="短信发送失败，每天最多发送5次！";}else{if(aE=="error"){aF="手机号码不正确";}else{if(aE=="nopub"){aF="问卷未运行，不能填写";}else{aF=aE;}}}}}}if(aF){if(q.errorMessage){q.errorMessage.innerHTML="";}writeError(q,"提示："+aF,3000,aD);}if(aF.indexOf("图形验证码")>-1){i.disabled=false;}i.isSending=false;};k.open("get","/Handler/AnswerSmsHandler.ashx?q="+activityId+"&mob="+escape(q.mobileinput.value)+"&valcode="+aa+"&t="+(new Date()).valueOf());k.send(null);};E.resent=function(){var k=this;var i=60;var q=setInterval(function(){i--;if(i<57){k.isSending=false;}if(i>0){k.innerHTML="重发("+i+"秒)";}else{k.innerHTML="发送验证码";k.disabled=false;clearInterval(q);}},1000);};B[1].onchange=B[1].onblur=function(){var q=trim(this.value);var k=this.par;if(q.length!=6){if(k.errorMessage){k.errorMessage.innerHTML="";}writeError(k,"提示：请输入6位数字！",3000,true);return;}if(!/^\d+$/.exec(q)){if(k.errorMessage){k.errorMessage.innerHTML="";}writeError(k,"提示：请输入6位数字！",3000,true);return;}if(k.issmsvalid&&k.mobile==k.mobileinput.value){return;}if(k.prevcode==q){return;}k.prevcode=q;var i=getXmlHttp();i.onreadystatechange=function(){if(i.readyState!=4){return;}if(i.status!=200){return;}var aD=i.responseText;k.issmsvalid=false;var aE="";var aa=false;if(aD=="true"){k.issmsvalid=true;aa=true;k.mobile=B[0].value;aE="成功通过验证";}else{if(aD=="send"){aE="请先发送验证码，每天最多发送5次！";}else{if(aD=="no"){aE="验证码输入错误超过5次，无法再提交";}else{if(aD=="error"){aE="验证码输入错误";}}}}if(aE){if(k.errorMessage){k.errorMessage.innerHTML="";}writeError(k,"提示："+aE,3000,aa);}};i.open("get","/Handler/AnswerSmsValidateHandler.ashx?q="+activityId+"&mob="+escape(k.mobileinput.value)+"&code="+escape(q)+"&t="+(new Date()).valueOf());i.send(null);};}}}else{if(S=="gapfill"){var B=$$("input",b[M]);for(var x=0;x<B.length;x++){B[x].onkeyup=function(){txtChange(this);};if(!B[x].onclick){B[x].onclick=B[x].onkeyup;}B[x].onblur=B[x].onchange=function(){txtChange(this,1);};B[x].parent=b[M];}b[M].gapFills=B;}}if(S=="radio_down"||(S=="check"&&m._mode)){var I=$$("select",b[M]);if(I.length>0){I[0].onchange=itemClick;I[0].parent=b[M];b[M].itemSel=I[0];}}var s=$$("div",b[M]);var aA=0;var aC=null;for(L=0;L<s.length;L++){if((S=="radio"||S=="check")&&!m.isRate){var u=s[L].getAttribute("rel");if(u){var J=s[L].getElementsByTagName("a");if(J.length==0){s[L].onclick=function(){var k=this.getAttribute("rel");var i=document.getElementById(k);i.click();};}}}if(s[L].className.toLowerCase()=="div_title_question"){b[M].divTitle=s[L];}else{if(s[L].className.toLowerCase()=="slider"){if(S=="matrix"||S=="sum"){aC=s[L].parentNode.parentNode;aA++;}else{if(S=="slider"){aC=b[M];}}aC.divSlider=s[L];s[L].parent=aC;var ad=s[L].getAttribute("minvalue");var Z=s[L].getAttribute("maxvalue");b[M].dataNode._minvalue=ad;b[M].dataNode._maxvalue=Z;var ab;if(S=="sum"){ab=aC.getElementsByTagName("input")[0];}else{var A=s[L].getAttribute("rel");ab=document.getElementById(A);}var at=new neverModules.modules.slider({targetId:s[L].id,sliderCss:"imageSlider1",barCss:"imageBar1",min:parseInt(ad),max:parseInt(Z),sliderValue:ab,hints:slider_hint,change:itemClick});at.create();aC.sliderImage=at;var aw=s[L].getAttribute("defvalue");if(aw&&isInt(aw)){at.setValue(parseInt(aw));aC.divSlider.value=parseInt(aw);if(S=="sum"){if(hasJoin&&aw){if(b[M].sumLeft==undefined){b[M].sumLeft=m._total-parseInt(aw);}else{b[M].sumLeft=b[M].sumLeft-parseInt(aw);}}else{b[M].sumLeft=0;}}}if(hasJoin=="1"){at._slider.onclick=function(){};at._initMoveSlider=function(){};}}}}if(S=="matrix"){var ax=new Array();var an=b[M].itemTrs;if(an){for(var L=0;L<an.length;L++){var am=an[L].getAttribute("rindex");if(parseInt(am)==am){ax.push(an[L]);}}if(ax.length>0){b[M].itemTrs=ax;}}}if(m&&m._hasjump){cur_page=ag;if(hasJoin){jumpJoin(b[M],ag);}else{clearAllOption(b[M]);}cur_page=0;}if(m._referedTopics){O.push(b[M]);}if(hasJoin&&window.cancelInputClick){cancelInputClick(b[M]);}}if(ag>0&&hasJoin){pageHolder[ag].style.display="none";}}completeLoaded=true;if(window.cepingCandidate){var ae=cepingCandidate.split(",");var g=new Object();for(var ak=0;ak<ae.length;ak++){var r=ae[ak].replace(/(\s*)/g,"").replace(/&/g,"");g[r]="1";}var b=pageHolder[0].questions[0];if(b.itemInputs){for(var M=0;M<b.itemInputs.length;M++){var z=b.itemInputs[M].parentNode;var h=z.getElementsByTagName("label")[0];if(!h){continue;}var W=trim(h.innerHTML);W=W.replace(/(\s*)/g,"").replace(/&amp;/g,"");if(g[W]){b.itemInputs[M].checked=true;}}}createItem(b);b.style.display="none";b.isCepingQ="1";}if(window.totalCut&&window.totalCut>0){for(var M=0;M<window.totalCut;M++){var o=document.getElementById("divCut"+(M+1));var av=o.getAttribute("relation");if(av&&av!="0"){var l=av.split(",");var X=l[0];var ar=l[1].split(";");for(var au=0;au<ar.length;au++){var y=X+","+ar[au];if(!relationHT[y]){relationHT[y]=new Array();}relationHT[y].push(o);}if(!relationQs[X]){relationQs[X]=new Array();}relationQs[X].push(o);}var d=o.getAttribute("titletopic");if(d){var ah=questionsObject[d];if(ah){if(!ah.dataNode._titleTopic){ah.dataNode._titleTopic=new Array();}var az=o.getAttribute("topic");ah.dataNode._titleTopic.push(az);var Q=o.childNodes[0];if(Q){Q.innerHTML=Q.innerHTML.replace("[q"+d+"]","<span id='spanTitleTopic"+az+"' style='text-decoration:underline;'></span>");}}}}}if(!window.cepingCandidate){for(var M=0;M<O.length;M++){var F=O[M];createItem(F);}}for(var ag=0;ag<pageHolder.length;ag++){var b=pageHolder[ag].questions;for(var M=0;M<b.length;M++){var m=b[M].dataNode;var az=m._topic;if(relationQs[az]){relationJoin(b[M]);}if(hasJoin){referTitle(b[M]);}var al=b[M].getAttribute("qingjing");if(al){var ac=b[M].getElementsByTagName("input")[0];ac.checked=true;displayRelationRaidoCheck(b[M],m);}}}if(lastSavePage>0&&lastSavePage<totalPage){pageHolder[0].style.display="none";cur_page=lastSavePage-1;show_next_page(true);}if(lastSaveQ>=1){var aj=document.getElementById("div"+lastSaveQ);if(aj){aj.scrollIntoView();aj.onclick();joinedTopic=lastSaveQ;for(var M=1;M<=lastSaveQ;M++){progressArray[M+""]=true;}showProgressBar();}}if(totalQ==0){submit_table.style.display="none";}processMinMax();showProgressBar();if(window.hasQJump&&window.jqLoaded){jqLoaded();}}var prevPostion;var resizedMax;function getMaxTimeStr(c){var d="";var b=c;var a=parseInt(b/3600);if(a){if(a<10){d+="0";}d+=a+":";b=b%3600;}else{d="00:";}var e=parseInt(b/60);if(e){if(e<10){d+="0";}d+=e+":";b=b%60;}else{d+="00:";}if(b<0){b=0;}if(b){if(b<10){d+="0";}d+=b;}else{d+="00";}return d;}function processMinMax(){if(maxTimer){clearInterval(maxTimer);}if(minTimer){clearInterval(minTimer);}if(isRunning=="true"){var d=pageHolder[cur_page]._maxtime;var g=document.getElementById("spanTimeTip");if(window.hasSurveyTime){if(!initMaxSurveyTime){initMaxSurveyTime=window.maxSurveyTime;}d=window.maxSurveyTime;if(cur_page>0){d--;}if(g){g.innerHTML="剩余作答时间";}}var c=new Date();if(d){if(langVer==1){g.innerHTML="Remaining ";}addEventSimple(window,"resize",resizeMaxTime);mmMaxTime();hasMaxtime=true;divMaxTime.style.display="";var f=divMaxTime.getElementsByTagName("b")[0];if(f){f.innerHTML="";}spanMaxTime.innerHTML=getMaxTimeStr(d);maxTimer=setInterval(function(){var m=new Date();var h=parseInt((m-c)/1000);var l=d-h;if(window.maxSurveyTime){window.maxSurveyTime--;}spanMaxTime.innerHTML=getMaxTimeStr(l);if(l<=0){clearInterval(maxTimer);divMaxTime.style.display="none";if(hasSurveyTime){while(cur_page<totalPage-1){pageHolder[cur_page].hasExceedTime=true;show_next_page();}}pageHolder[cur_page].hasExceedTime=true;if(cur_page<totalPage-1){show_next_page();}else{pageHolder[cur_page].style.display="none";if(submit_button.initVal){submit_button.value=submit_button.initVal;}submit_button.disabled=false;var k="提示：您的作答时间已经超过最长时间限制，请直接提交答卷！";if(langVer==1){k="Time is up,please submit!";}if(hasSurveyTime&&tCode.style.display=="none"&&hasAnswer){submit(1);}else{var i=document.createElement("div");i.style.color="red";i.style.fontSize="16px";i.innerHTML=k;i.style.textAlign="center";submit_div.insertBefore(i,submit_table);}}}},1000);}var b=pageHolder[cur_page]._mintime;var e=!IsSampleService||(IsSampleService&&promoteSource=="t")||window.pubNeedApply;if(!e){b=0;}if(b){if(pageHolder[cur_page]._istimer){var a=b;if(next_page){next_page.style.display="none";}if(pre_page){pre_page.style.display="none";}minTimer=setInterval(function(){var i=new Date();var h=parseInt((i-c)/1000);a=b-h;if(a<=0){clearInterval(minTimer);if(cur_page<totalPage-1){show_next_page();}else{alert("提示：您的作答时间已经超过最长时间限制，请直接提交答卷！");pageHolder[cur_page].style.display="none";}}},1000);}else{if(!isSuper){if(next_page){next_page.disabled=true;}submit_button.disabled=true;}if(next_page){next_page.initVal=next_page.value;}if(!submit_button.initVal){submit_button.initVal=submit_button.value;}if(next_page){next_page.value=b+minTimeTip;}submit_button.value=b+minTimeTip;var a=b;minTimer=setInterval(function(){var i=new Date();var h=parseInt((i-c)/1000);a=b-h;if(next_page){next_page.value=a+minTimeTip;}submit_button.value=a+minTimeTip;if(a<=0){clearInterval(minTimer);if(next_page){next_page.disabled=false;}submit_button.disabled=false;if(next_page){next_page.value=next_page.initVal;}submit_button.value=submit_button.initVal;}},1000);}}}}function resizeMaxTime(){resizedMax=true;mmMaxTime();}function mmMaxTime(){var a=document.getElementById("mainCss");if(!a){divMaxTime.style.right="50px";return;}var b=getTop(a);divMaxTime.style.top=b.y+"px";divMaxTime.style.left=(b.x-120)+"px";}function getPreviousNode(b){var a=b.previousSibling;if(a&&a.nodeType!=1){a=a.previousSibling;}return a;}function getNextNode(b){var a=b.nextSibling;if(a&&a.nodeType!=1){a=a.nextSibling;}return a;}function updateCart(){var h="";var n=0;for(var g=0;g<shopHT.length;g++){var l=shopHT[g];var p=l.itemInputs;for(var f=0;f<p.length;f++){var e=p[f];var d=parseInt(e.value);if(d==0){continue;}var c=e.parentNode.parentNode;var o=$$("div",c)[0].innerHTML;var b=$$("p",c)[0].getAttribute("price");var m=d*parseFloat(b).toFixed(2);var a='<li class="productitem"><span class="fpname">'+o+'</span><span class="fpnum">'+d+'</span><span class="fpprice">￥'+m+"</span></li>";h+=a;n+=m;}}h="<ul class='productslist'>"+h+'</ul><div class="ftotalprice"><span class="priceshow">￥'+n.toFixed(2)+"</span></div>";var k=document.getElementById("shopcart");k.innerHTML=h;k.style.display=n>0?"":"none";}function initItem(h){var b=$$("input",h);if(b.length==0){b=$$("textarea",h);}for(var g=0;g<b.length;g++){b[g].parent=h;if(h.isShop){var p=getPreviousNode(b[g]);p.rel=b[g];var a=getNextNode(b[g]);a.rel=b[g];a.onclick=function(){var v=parseInt(this.rel.value);var u=false;var s=0;var c=this.rel.getAttribute("num");if(c){u=true;s=parseInt(c);}if(u&&v>=s){var t="库存只剩"+s+"件，不能再增加！";if(s<=0){t="已售完，无法添加";}alert(t);}else{this.rel.value=v+1;updateCart();}};p.onclick=function(){var c=parseInt(this.rel.value);if(c<1){return;}this.rel.value=c-1;updateCart();};b[g].onchange=b[g].onblur=function(){if(!isInt(this.value)||this.value-1<0){this.value=0;}updateCart();};continue;}if(!b[g].onclick){b[g].onclick=itemClick;}if(b[g].tagName=="TEXTAREA"){b[g].onchange=b[g].onblur=itemClick;}var r=b[g].getAttribute("rel");if(r){var o=null;if(r=="psibling"){o=getPreviousNode(b[g]);b[g].onclick=itemClick;}else{o=document.getElementById(r);}o.itemText=b[g];b[g].choiceRel=o;if(h.dataNode&&!h.dataNode.isSort){b[g].onblur=fcInputboxBlur;}if(h.dataNode&&h.dataNode._referedTopics){b[g].onchange=itemClick;}if(!b[g].value){b[g].value=defaultOtherText;}b[g].style.color="#999999";var n=b[g].getAttribute("req");if(n=="true"){o.req=true;}else{o.req=false;}}var l="";if(h.dataNode&&(h.dataNode._type=="radio"||h.dataNode._type=="check")){l=b[g].getAttribute("rimg");if(l){var q=document.getElementById(l);if(q){q.onclick=function(v){var u=this.getAttribute("pimg");if(u){var s=document.createElement("img");s.onload=function(){var x=document.getElementById("divImgPop");if(!x){x=document.createElement("div");x.id="divImgPop";document.body.appendChild(x);}var C=this.width;var A=this.height;var z=(document.documentElement.clientWidth||document.body.clientWidth)-60;var B=(document.documentElement.clientHeight||document.body.clientHeight)-40;var y,w;var D=0.9;if(A>B*D){w=B*D;y=w/A*C;if(y>z*D){y=z*D;}}else{if(C>z*D){y=z*D;w=y/C*A;}else{y=C;w=A;}}x.innerHTML="<img src='"+u+"' style='width:"+y+"px;' alt=''/>";PDF_launch("divImgPop",y+20,w+20);};s.src=u;stopPropa(v);}else{var c=this.getAttribute("irel");if(c){var t=document.getElementById(c);t.parentNode.onclick();}}};}else{var k=l;}}}var f=h.dataNode&&(h.dataNode._type=="radio"||h.dataNode._type=="check")&&!h.dataNode.isSort&&(!h.dataNode.isRate||h.dataNode._mode=="101");if(h.isTrap||f){var i=b[g].nextSibling;if(b[g].choiceRel){var o=getPreviousNode(b[g]);if(o){o.style.display="inline-block";b[g].style.position="static";}}else{if(i!=null){var m=b[g].parentNode;if(!l){m.onmouseover=function(){this.style.background="#efefef";};m.onmouseout=function(){this.style.background="";};}if(b[g].checked&&b[g].type=="radio"){var e=getPreviousNode(b[g]);if(e&&e.tagName.toLowerCase()=="a"){h.prevARadio=e;}}m.onclick=function(w){var v=this.getElementsByTagName("a")[0];if(!v){return;}var c=v.getAttribute("rel");if(!c){return;}var u=document.getElementById(c);if(u.disabled){return;}var t=u.type=="radio";if(t){v.className="jqRadio jqChecked";u.checked=true;}else{u.checked=!u.checked;v.className=u.checked?"jqCheckbox jqChecked":"jqCheckbox";}var s=u.parent.parent||u.parent;itemClick.call(u);if(t){if(s&&s.prevARadio&&s.prevARadio!=v){s.prevARadio.className="jqRadio";}s.prevARadio=v;}};}}}else{if(h.tagName=="TR"&&(b[g].type=="radio"||b[g].type=="checkbox")){var d=b[g].parentNode;d.style.cursor="pointer";if(hasJoin&&b[g].checked&&b[g].type=="radio"){var e=getPreviousNode(b[g]);if(e&&e.tagName.toLowerCase()=="a"){if(b[g].parent){b[g].parent.prevARadio=e;}}}d.onclick=function(v){var c=this.getElementsByTagName("input");var s=c[0];var u=getPreviousNode(s);if(s.type=="checkbox"){s.checked=!s.checked;s.onclick();if(u){u.className=s.checked?"jqCheckbox jqChecked":"jqCheckbox";}}else{if(u){u.className="jqRadio jqChecked";var t=s.parent;if(t.prevARadio&&t.prevARadio!=u){t.prevARadio.className="jqRadio";}t.prevARadio=u;}s.checked=true;s.onclick();stopPropa(v);}};d.onmouseover=function(){this.style.background="#efefef";};d.onmouseout=function(){this.style.background="";};}}}if(b.length>0){h.itemInputs=b;}}function initLikertItem(b){var e=$$("li",b);var a=new Array();var f=false;var d;for(j=0;j<e.length;j++){var c=e[j].className.toLowerCase();if(e[j].className&&(c.indexOf("off")>-1||c.indexOf("on")>-1)){e[j].onclick=itemLiClick;e[j].onmouseover=itemMouseOver;e[j].onmouseout=itemMouseOut;e[j].parent=b;a.push(e[j]);if(c.indexOf("on")>-1){d=e[j];}else{if(c.indexOf("off")>-1&&d){d.parent.holder=d.value;}}}}if(e.length>0){if(d){d.parent.holder=d.value;}b.itemLis=a;}}function referTitle(e,h){var k=e.dataNode;if(!k._titleTopic){return;}var b="";if(h==undefined&&e.itemInputs){for(var d=0;d<e.itemInputs.length;d++){if(e.itemInputs[d].checked){var g=getNextNode(e.itemInputs[d]);if(b){b+="&nbsp;";}b+=g.innerHTML;}}}else{b=h||"";}for(var a=0;a<k._titleTopic.length;a++){var f=k._titleTopic[a];var c=document.getElementById("spanTitleTopic"+f);if(c){c.innerHTML=b;}}}function createItem(t){var B=t.dataNode;var z=B._referedTopics.split(",");var F=new Array();for(var p=0;p<t.itemInputs.length;p++){if(t.itemInputs[p].checked){F.push(t.itemInputs[p]);}}for(var p=0;p<z.length;p++){var u=z[p];var v=questionsObject[u];if(!v){continue;}var a=false;var c=document.getElementById("divRef"+u);if(!c){continue;}var g=0;var C=[];var e=new Object();var o=null;var D=document.getElementById("lbl"+B._topic+"_1")?true:false;switch(v.dataNode._type){case"matrix":case"sum":if(window.cepingCandidate){continue;}var s=v.dataNode._mode;for(var y=0;y<t.itemInputs.length;y++){var d=t.itemInputs[y];if(!d.value||d.type!="checkbox"){continue;}var w=parseInt(d.value)-1+g;if(!v.itemTrs[w]){break;}v.itemTrs[w].style.display=d.checked?"":"none";if(d.checked&&!v.itemTrs[w].hasInit&&v.dataNode._type=="matrix"){v.itemTrs[w].hasInit=true;if(s&&s-100<0){initLikertItem(v.itemTrs[w]);}else{initItem(v.itemTrs[w]);}}if(d.checked){a=true;if(d.itemText){var G=d.itemText.value;var k=v.itemTrs[w].getElementsByTagName("th")[0];if(k){if(!k.span){k.span=document.createElement("span");k.appendChild(k.span);}if(G&&G!=defaultOtherText){k.span.innerHTML="[<span style='color:red;'>"+G+"</span>]";}else{k.span.innerHTML="";}}}}if(hasJoin&&v.itemTrs[w].divSlider){var b=v.itemTrs[w].divSlider.getAttribute("defvalue");if(b&&isInt(b)){v.itemTrs[w].sliderImage.setValue(parseInt(b));}}if(D){var l=v.itemTrs[w].getAttribute("group");if(l){o=l;C.push(l);}if(o){if(d.checked&&!e[o]){e[o]="1";}}}}if(g==1){v.itemTrs[0].style.display=a?"":"none";}c.style.display=a?"none":"";v.displayContent=a;v.referDiv=t;break;case"radio":case"check":var i=v.itemInputs;var A=new Object();for(var y=0;y<t.itemInputs.length;y++){var d=t.itemInputs[y];if(d.checked){A[d.value]=d;}}for(var y=0;y<i.length;y++){var d=i[y];if(d.type!="checkbox"&&d.type!="radio"){continue;}var n=A[d.value];var h=d.parentNode;if(h.tagName.toLowerCase()=="td"){h=h.parentNode.parentNode.parentNode.parentNode;}if(n){h.style.display="";a=true;if(n.itemText&&d.itemText){d.itemText.value=n.itemText.value;}}else{h.style.display="none";}if(D){var l=h.getAttribute("group");if(l){o=l;C.push(l);}if(o){if(n&&!e[o]){e[o]="1";}}}}c.style.display=a?"none":"";v.displayContent=a;break;}if(D){for(var x=0;x<C.length;x++){var l=C[x];var f=e[l];var E="lbl"+u+"_"+l;var r=document.getElementById(E);if(r){r.style.display=f?"":"none";}}}}}var curMatrixItem=null;function divMatrixItemClick(){if(curMatrixItem==this){return;}if(curMatrixItem!=null){curMatrixItem.style.background=curMatrixItem.prevBackColor||"";if(curMatrixItem.daoZhi){itemInputs=curMatrixItem.itemInputs;for(var a=0;a<itemInputs.length;a++){itemInputs[a].parentNode.style.background="";}}}curMatrixItem=this;if(!this.parent){return;}var b=this.parent.dataNode;updateProgressBar(b);}function divQuestionClick(){if(curdiv==this){return;}showLeftBar();curdiv=this;if(curMatrixItem!=null&&curMatrixItem.parent!=curdiv){curMatrixItem.style.background=curMatrixItem.prevBackColor||"";}if(curMatrixItem!=null&&curMatrixItem.parent==curdiv){this.style.background="";}if(this.removeError){this.removeError();}if(!completeLoaded){curdiv=null;}if(this.itemTextarea&&curdiv.parentNode&&curdiv.parentNode.style.display!="none"){this.itemTextarea.focus();}}function showLeftBar(){if(window.divLeftBar&&!hasDisplayed){if(divProgressImg){divProgressImg.style.visibility="visible";document.getElementById("loadprogress").style.visibility="visible";}if(divSave){divSave.parentNode.style.visibility="visible";divSave.parentNode.style.marginTop="5px";}hasDisplayed=true;divLeftBar.style.background="#ffffff";}}var loadcss=null;var loadprogress=null;function updateProgressBar(b){var a=b._topic;if(a>MaxTopic){MaxTopic=a;}if(!progressArray[a]){joinedTopic++;progressArray[a]=true;showProgressBar(b);}setTimeout(function(){postHeight();},500);}function showProgressBar(d){if(window.divProgressImg){if(!loadcss){loadcss=document.getElementById("loadcss");}if(!loadprogress){loadprogress=document.getElementById("loadprogress");}var c=totalQ;var e=joinedTopic;if(progressBarType==2){c=totalPage;e=cur_page+1;}var b=parseFloat(e)/c*100;b=b||0;if(b>=70&&d&&d._topic==totalQ){b=100;}var a=b+"%";loadcss.style.height=a;if(progressBarType==1){loadprogress.innerHTML="&nbsp;&nbsp;"+b.toFixed(0)+"%";}else{loadprogress.innerHTML="&nbsp;"+e+"/"+c+page_info;}if(hrefSave){if(spanSave){clearInterval(saveInterval);}}}}function checkMinMax(g,e,d){if((e._maxValue>0||e._minValue>0)){var c=d.itemInputs;var h=0;for(var b=0;b<c.length;b++){if(c[b].checked){h++;}}if(d.parent){d=d.parent;}if(!d.divChecktip){d.divChecktip=document.createElement("div");d.appendChild(d.divChecktip);d.divChecktip.style.color="666";}var a="&nbsp;&nbsp;&nbsp;您已经选择了"+h+"项";if(e._maxValue>0&&h>e._maxValue){if(langVer==0){alert("此题最多只能选择"+e._maxValue+"项");}g.checked=false;if(g.onclick){g.onclick();}var f=getPreviousNode(g);if(f&&f.tagName.toLowerCase()=="a"){f.className="jqCheckbox";}g.checked=false;h--;a="&nbsp;&nbsp;&nbsp;您已经选择了"+h+"项";}else{if(e._minValue>0&&h<e._minValue){a+=",<span style='color:red;'>少选择了"+(e._minValue-h)+"项</span>";if(g.checked&&e._select[g.value-1]&&e._select[g.value-1]._item_huchi){a="";}}}if(langVer==0){d.divChecktip.innerHTML=a;}}return false;}function itemSortClick(){var b=this.getAttribute("rel");if(b){var e=document.getElementById(b);var c=e.selectedIndex;var a=e.options.length;if(this.name=="up"&&c>0){var d=e.options[c];var f=e.options[c-1];e.insertBefore(d,f);}else{if(this.name=="first"&&c>0){var d=e.options[c];var f=e.options[0];e.insertBefore(d,f);}else{if(this.name=="down"&&c>=0&&c<a-1){var d=e.options[c];var g=e.options[c+1];e.insertBefore(g,d);}else{if(this.name=="last"&&c>=0&&c<a-1){var d=e.options[c];var g=e.options[a-1];e.insertBefore(d,g);e.insertBefore(g,d);}}}}}}function checkMatrixMaxValue(e,c){if(c&&c.dataNode._maxvalue){var a=e.parentNode.parentNode.getElementsByTagName("input");var d=0;for(var b=0;b<a.length;b++){if(a[b].checked){d++;}}if(d-c.dataNode._maxvalue>0){e.checked=false;return true;}}return false;}function stopPropa(a){a=a||window.event;if(a){if(a.stopPropagation){a.stopPropagation();}else{a.cancelBubble=true;}}}function itemClick(m){var f=this.parent.parent||this.parent;if(f.isTrap){return;}hasAnswer=true;var o=f.dataNode;updateProgressBar(o);if(this.itemText&&this.itemText.onclick){if(this.checked){this.itemText.onclick();}else{if(this.itemText.onblur){this.itemText.onblur();}}}if(this.type=="checkbox"){checkHuChi(f,this);var p=this.getAttribute("rel");if(p){var c=document.getElementById(p);var r=c.options;if(this.checked){var b=this.nextSibling.nodeValue||this.nextSibling.innerHTML;if(!b&&this.nextSibling.nextSibling){b=this.nextSibling.nextSibling.innerHTML;}var d=false;for(var a=0;a<r.length;a++){if(r[a].value==this.value){d=true;break;}}if(!d){c.options[r.length]=new Option(b,this.value);}}else{for(var a=0;a<r.length;a++){if(r[a].value==this.value){r[a]=null;}}}}if(this.itemText){if(!this.checked){this.itemText.pvalue=this.itemText.value;this.itemText.value="";}else{this.itemText.value=this.itemText.pvalue||"";}}if(o._referedTopics){createItem(f);}referTitle(f);displayRelationRaidoCheck(f,o);checkMinMax(this,o,f);jump(f,this);if(o._type=="matrix"){checkMatrixMaxValue(this,f);divMatrixRel.style.display="none";var e=this.getAttribute("needfill");if(e&&this.checked){showMatrixFill(this);}if(f.removeError){f.removeError();}stopPropa(m);}}else{if(this.type=="radio"||o._type=="slider"||(o._type=="matrix"&&o._mode!="201"&&o._mode!="301"&&o._mode!="302")){if(!o._requir&&!f.hasClearHref){addClearHref(f);}if(this.type=="radio"){if(o._type=="matrix"){processRadioInput(this.parentNode.parentNode,this);divMatrixRel.style.display="none";var e=this.getAttribute("needfill");if(e){showMatrixFill(this);}if(f.removeError){f.removeError();}}else{processRadioInput(f,this);}referTitle(f);}displayRelationRaidoCheck(f,o);jump(f,this);}else{if(o._type=="matrix"&&o._mode=="201"){var l=f.itemTrs;var g=0;var q;for(var a=0;a<l.length;a++){if(l[a].style.display=="none"){continue;}g=validateMatrix(o,l[a],l[a].itemInputs[0]);if(g&&!q){q=l[a].itemInputs[0];break;}}if(f.removeError){f.removeError();}if(q){f.errorControl=q;validate_ok=writeError(f,verifyMsg,3000);}if(f.dataNode._hasjump){var n=false;for(var a=0;a<l.length;a++){var k=l[a].itemInputs[0];if(trim(k.value)!=""){n=true;break;}}jumpAny(n,f);}stopPropa(m);}else{if(o._type=="sum"){if(this.parent.sliderImage){sumClick(f,this.parent.sliderImage.sliderValue);}else{sumClick(f,this);}}else{if(this.type=="text"){processTextR(this,f,o);stopPropa(m);}else{if(this.nodeName=="SELECT"){if(o._type=="check"){return;}f.focus();jump(f,this);displayRelationDropDown(f,o);var h=this.options[this.selectedIndex].text;if(this.value==-2){h="";}referTitle(f,h);}}}}}}postHeight();}function processRadioInput(a,b){if(a.prevRadio&&a.prevRadio.itemText&&a.prevRadio!=b){a.prevRadio.itemText.pvalue=a.prevRadio.itemText.value;a.prevRadio.itemText.value="";}if(b.itemText&&b!=a.prevRadio){b.itemText.value=b.itemText.pvalue||"";}a.prevRadio=b;}function processTextR(d,a,b){if(d.choiceRel){if(d.value==defaultOtherText){d.value="";}d.choiceRel.checked=true;if(b._type=="matrix"&&b._mode=="102"){var e=checkMatrixMaxValue(d.choiceRel,a);if(e){if(d.blur){d.blur();}return;}}d.style.color="#000000";d.style.background="";if(b._referedTopics){createItem(a);}if(d.choiceRel.type=="checkbox"){if(d.pvalue&&!d.value){d.value=d.pvalue;}var c=getPreviousNode(d.choiceRel);if(c&&c.tagName.toLowerCase()=="a"){c.className="jqCheckbox jqChecked";}checkHuChi(a,d.choiceRel);checkMinMax(d.choiceRel,b,a);}else{if(d.choiceRel.type=="radio"){if(b._type=="matrix"){processRadioInput(d.parentNode.parentNode,d.choiceRel);}else{var c=getPreviousNode(d.choiceRel);if(c&&c.tagName.toLowerCase()=="a"){c.className="jqRadio jqChecked";if(a&&a.prevARadio&&a.prevARadio!=c){a.prevARadio.className="jqRadio";}a.prevARadio=c;}processRadioInput(a,d.choiceRel);}}}displayRelationRaidoCheck(a,b);jump(a,d.choiceRel);}}function checkHuChi(c,f){if(!f.checked){return;}var e=c.dataNode;if(!e.hasHuChi){return;}var a=c.itemInputs;var d=e._select[f.value-1]._item_huchi;for(var b=0;b<a.length;b++){if(a[b].type!="checkbox"){continue;}if(a[b]==f){continue;}if(!a[b].checked){continue;}if(d){if(a[b].parentNode.onclick){a[b].parentNode.onclick();}a[b].checked=false;}else{var g=e._select[a[b].value-1]._item_huchi;if(g){if(a[b].parentNode.onclick){a[b].parentNode.onclick();}a[b].checked=false;}}}}function relationJoin(b){if(b.style.display!="none"){var c=b.dataNode;var a=c._type;if(a=="radio"||a=="check"){displayRelationRaidoCheck(b,c);}else{if(a=="radio_down"){displayRelationDropDown(b,c);}}}}function displayRelationRaidoCheck(h,k){var d=k._topic;if(!relationQs[d]){return;}h.hasDisplayByRelation=new Object();var i=-1;if(h.itemLis){var e=h.itemLis;for(var f=0;f<e.length;f++){if(e[f].className.indexOf("on")>-1){i=f+1;}}for(var f=0;f<e.length;f++){var c=false;var b=e[f].value;var g=d+","+b;if(i>-1&&b==i){c=true;}displayByRelation(h,g,c);}}else{var e=h.itemInputs;for(var f=0;f<e.length;f++){var c=false;var b=e[f].value;var g=d+","+b;if(e[f].checked){c=true;}displayByRelation(h,g,c);var a=d+",-"+b;if(relationHT[a]){displayByRelationNotSelect(h,a,c);}}}loopJoinProgressQ(d);}function loopJoinProgressQ(b){if(!relationQs[b]){return;}for(var d=0;d<relationQs[b].length;d++){var c=relationQs[b][d];if(!c.dataNode){continue;}var a=c.dataNode._topic;if(c.style.display=="none"&&!progressArray[a]){progressArray[a]="jump";joinedTopic++;}loopJoinProgressQ(a);}}function displayRelationDropDown(f,h){var c=h._topic;if(!relationQs[c]){return;}var i=f.itemSel;var g=f.itemSel.value;f.hasDisplayByRelation=new Object();for(var d=0;d<i.length;d++){var b=false;var a=i[d].value;var e=c+","+a;if(a==g){b=true;}displayByRelation(f,e,b);}loopJoinProgressQ(c);}function displayByRelation(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){var e="";if(d[a].dataNode){e=d[a].dataNode._topic;}else{e=d[a].getAttribute("topic");}if(c.hasDisplayByRelation[e]){continue;}if(!b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(b){d[a].style.display="";c.hasDisplayByRelation[e]="1";if(progressArray[e]=="jump"){progressArray[e]=false;joinedTopic--;}if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function displayByRelationNotSelect(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){var e="";if(d[a].dataNode){e=d[a].dataNode._topic;}else{e=d[a].getAttribute("topic");}if(c.hasDisplayByRelation[e]){continue;}if(b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(!b){d[a].style.display="";c.hasDisplayByRelation[e]="1";if(progressArray[e]=="jump"){progressArray[e]=false;joinedTopic--;}if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function loopHideRelation(a){var c="";if(a.dataNode){c=a.dataNode._topic;}else{c=a.getAttribute("topic");}var b=relationQs[c];if(b){for(var d=0;d<b.length;d++){loopHideRelation(b[d],false);}}clearAllOption(a);a.style.display="none";if(relationNotDisplayQ[c]==""){relationNotDisplayQ[c]="1";}}function sumClick(m,l,n){var e=m.getElementsByTagName("input");var s=m.dataNode;updateProgressBar(s);if(e){var r=e.length;var w=s._total;var c=w;var g=0;var u;var t;var h=l.value;if(parseInt(h)<0){l.value="";}var p=new Array();for(var q=0;q<r;q++){var k=e[q].value;var a=m.itemTrs[q];var x=a.sliderImage;if(a.style.display=="none"){k="";e[q].value="";continue;}else{u=e[q];t=x;e[q].sIndex=q;p.push(e[q]);}if(k&&trim(k)){if(isInt(k)){c=c-parseInt(k);if(x._value==undefined){x.setValue(parseInt(h),true);}else{if(n&&e[q]==l){x.setValue(parseInt(h),true);}}}else{e[q].value="";g++;}}else{if(a.style.display=="none"){}else{g++;}}}if(g==1&&c>=0){t.setValue(c,true);u.value=c;c=0;}var d="";if(g==0&&c!=0){var f=parseInt(u.value)+c;if(f>=0){if(u!=l){t.setValue(f,true);u.value=f;c=0;}else{if(p.length==2){var b=w-parseInt(u.value);var o=p[0].sIndex;m.itemTrs[o].sliderImage.setValue(b);p[0].value=b;c=0;}}}else{d="，<span style='color:red;'>"+sum_warn+"</span>";}}if(c==0){for(var q=0;q<r;q++){if(!e[q].value){e[q].value="0";}}}m.sumLeft=c;if(m.relSum){m.relSum.innerHTML=sum_total+"<b>"+w+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(w-c)+"</span>"+d;}jump(m,this);}}function jump(b,e){var c=b.dataNode;var a=c._anytimejumpto;var d=c._hasjump;if(d){if(a>0){jumpAnyChoice(b);}else{if(a==0&&c._type!="radio"&&c._type!="radio_down"){jumpAnyChoice(b);}else{jumpByChoice(b,e);}}}}function jumpAnyChoice(d,e){var a=d.itemInputs||d.itemLis||d.itemTrs||d.gapFills;var c=false;if(a){for(var b=0;b<a.length;b++){if(a[b].checked){c=true;}else{if(a[b].className.indexOf("on")>-1){c=true;}else{if(a[b].divSlider&&a[b].divSlider.value){c=true;}else{if(a[b].tagName=="TEXTAREA"&&trim(a[b].value)!=""){c=true;}else{if(a[b].type=="text"&&trim(a[b].value)!=""){c=true;}else{if(a[b].itemSels){for(var f=0;f<a[b].itemSels.length;f++){if(a[b].itemSels[f]){c=true;break;}}}}}}}}if(c){break;}}}else{if(d.itemSel){if(d.itemSel.selectedIndex>0){c=true;}else{c=false;}}else{if(d.divSlider){c=(d.divSlider.value!=undefined&&d.divSlider.value!=null)?true:false;}else{if(d.itemTextarea){c=trim(d.itemTextarea.value)!="";}else{if(d.uploadFrame){c=d.fileName?true:false;}}}}}jumpAny(c,d,e);}function jumpByChoice(b,d){var c=b.dataNode;if(d.value=="-2"){processJ(b.indexInPage-0,0);}else{if(d.value=="-1"||d.value==""){processJ(b.indexInPage-0,0);}else{if((c._type=="radio"||c._type=="radio_down")&&parseInt(d.value)==d.value){var a=c._select[d.value-1]._item_jump;processJ(b.indexInPage-0,a-0);}}}}function txtChange(c,l){var e=c.parent.parent||c.parent;updateProgressBar(e.dataNode);hasAnswer=true;if(e.removeError){e.removeError();}var h=e.dataNode._verify;if((e.dataNode._needOnly||(e.dataNode._hasList&&e.dataNode._listId!=-1))&&trim(c.value)!=""&&h!="地图"&&l){var a=getXmlHttp();a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){if(unescape(a.responseText)=="false1"){c.isOnly=false;if(e.verifycodeinput){e.verifycodeinput.parentNode.style.display="none";}writeError(e,validate_only,3000);}else{if(unescape(a.responseText)=="false2"){c.isInList=false;c.isOnly=true;writeError(e,validate_list,3000);}else{c.isInList=true;c.isOnly=true;}}}else{c.isOnly=true;c.isInList=true;}}};var n=e.dataNode._needOnly;var i=e.dataNode._hasList&&e.dataNode._listId!=-1;var d=e.dataNode._listId;a.open("get","/Handler/AnswerOnlyHandler.ashx?q="+activityId+"&at="+escape(c.value)+"&qI="+e.dataNode._topic+"&o="+n+"&l="+i+"&lid="+d+"&t="+(new Date()).valueOf());a.send(null);}if(e.dataNode._type=="matrix"&&e.dataNode._mode=="303"){h="数字";}if(c.value!=""&&h&&h!="0"){if(e.removeError){e.removeError();}var k=e.dataNode;var m=e.getAttribute("issample");var g=true;if(m&&promoteSource!="t"){g=false;}if(g){var b=verifyMinMax(c,h,k._minword,k._maxword);if(b!=""){validate_ok=writeError(e,b,3000);}b=verifydata(c,h,e.dataNode);if(b!=""){validate_ok=writeError(e,b,3000);}}}if(e.dataNode._type=="gapfill"){var f=0;f=validateMatrix(e.dataNode,c,c);if(f){e.errorControl=c;writeError(e,verifyMsg,3000);}}if(e.dataNode._type=="sum"){sumClick(e,c,1);}else{jumpAny(trim(c.value)!="",e);}}function jumpAny(a,b,d){var c=b.dataNode;if(c._hasjump){if(a){processJ(b.indexInPage-0,c._anytimejumpto-0,d);}else{processJ(b.indexInPage-0,0,d);}}}function processJ(m,c,d){var a=m+1;var b=cur_page;var k=c==1||c==-1;for(var g=cur_page;g<pageHolder.length;g++){var l=pageHolder[g].questions;if(k){b=g;}for(var f=a;f<l.length;f++){var h=l[f].dataNode._topic;if(h==c||k){b=g;}if(h<c||k){l[f].style.display="none";if(!progressArray[h]){joinedTopic++;progressArray[h]="jump";}}else{if(relationNotDisplayQ[h]){var e=1;}else{l[f].style.display="";}if(progressArray[h]=="jump"){joinedTopic--;progressArray[h]=false;}if(l[f].dataNode._hasjump&&!d){clearAllOption(l[f]);}}}a=0;}if(c==1){joinedTopic=totalQ;}showProgressBar();}function addClearHref(b){var c=b.dataNode;var a=document.createElement("a");a.title=validate_info_submit_title2;a.className="link-999";a.style.marginLeft="25px";a.innerHTML="["+type_radio_clear+"]";a.href="javascript:void(0);";b.hasClearHref=true;b.divTitle.appendChild(a);b.clearHref=a;a.onclick=function(){clearAllOption(b);referTitle(b);jumpAny(false,b);};}function clearAllOption(d){var e=d.itemSel;if(e){e.selectedIndex=0;}if(d.divSlider&&d.divSlider.value!=undefined){d.sliderImage.setValue(d.dataNode._minvalue,true);d.divSlider.value=undefined;}var a=d.itemInputs||d.itemLis||d.itemTrs;if(!a){return;}d.hasClearHref=false;if(d.clearHref){d.clearHref.parentNode.removeChild(d.clearHref);d.clearHref=null;}for(var c=0;c<a.length;c++){if(a[c].checked){a[c].checked=false;var f=getPreviousNode(a[c]);if(f&&f.tagName.toLowerCase()=="a"){f.className=f.className.replace("jqChecked","");}}else{if(a[c].className.toLowerCase().indexOf("on")>-1){a[c].className="off"+d.dataNode._mode;}else{if(a[c].parent&&a[c].parent.holder){a[c].parent.holder=0;}else{if(a[c].divSlider&&a[c].divSlider.value){a[c].sliderImage.setValue(d.dataNode._minvalue,true);a[c].divSlider.value=undefined;}else{var g=a[c].itemInputs||a[c].itemLis;if(g){for(var b=0;b<g.length;b++){if(g[b].checked){g[b].checked=false;var f=getPreviousNode(g[b]);if(f&&f.tagName.toLowerCase()=="a"){f.className=f.className.replace("jqChecked","");}}else{if(g[b].className.toLowerCase().indexOf("on")>-1){g[b].className="off"+d.dataNode._mode;}else{if(g[b].parent&&g[b].parent.holder){g[b].parent.holder=0;}}}}}}}}}}if(d.holder){d.holder=0;}}function itemMouseOver(){var c=this.parent.parent||this.parent;if(c.dataNode.isRate){var a=this.parent.itemLis.length;var d="on";for(var b=0;b<a;b++){d=b<this.value?"on":"off";this.parent.itemLis[b].className=d+c.dataNode._mode;}}}function itemMouseOut(){var d=this.parent.parent||this.parent;if(d.dataNode.isRate){var a=this.parent.itemLis.length;var e="on";var c=this.parent.holder||0;for(var b=0;b<a;b++){e=b<c?"on":"off";this.parent.itemLis[b].className=e+d.dataNode._mode;}}}function itemLiClick(){var b=this.parent.parent||this.parent;var c=b.dataNode;updateProgressBar(c);if(c.isRate){this.parent.holder=this.value;for(var a=0;a<this.value;a++){this.parent.itemLis[a].className="on"+c._mode;}if(!c._requir&&!b.hasClearHref){addClearHref(b);}displayRelationRaidoCheck(b,c);jump(b,this);}}function set_data_fromServer(d){var m=new Array();m=d.split("¤");var h=m[0];var a=h.split("§");hasTouPiao=a[0]=="true";useSelfTopic=a[1]=="true";var q=0;var n=0;var l=true;var p=0;for(var k=1;k<m.length;k++){var f=new Object();var e=m[k].split("§");switch(e[0]){case"page":if(l){l=false;}else{n++;}p=0;if(e[2]=="true"){pageHolder[n]._iszhenbie=true;}else{if(e[2]=="time"){pageHolder[n]._istimer=true;}}pageHolder[n]._mintime=e[3]?parseInt(e[3]):"";pageHolder[n]._maxtime=e[4]?parseInt(e[4]):"";break;case"question":f._type=trim(e[0]);f._topic=trim(e[1]);f._height=trim(e[2]);f._maxword=trim(e[3]);if(e[4]=="true"){f._requir=true;}else{f._requir=false;}if(e[5]=="true"){f._norepeat=true;}else{f._norepeat=false;}if(trim(e[6])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[7]);f._verify=trim(e[8]);f._needOnly=e[9]=="true"?true:false;f._hasList=e[10]=="true"?true:false;f._listId=e[11]?parseInt(e[11]):-1;f._minword=e[12];pageHolder[n].questions[p].dataNode=f;p++;break;case"slider":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._minvalue=trim(e[3]);f._maxvalue=trim(e[4]);if(trim(e[5])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[6]);pageHolder[n].questions[p].dataNode=f;p++;break;case"fileupload":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._maxsize=trim(e[3]);f._ext=trim(e[4]);if(trim(e[5])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[6]);pageHolder[n].questions[p].dataNode=f;p++;break;case"gapfill":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._gapcount=trim(e[3]);if(trim(e[4])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[5]);pageHolder[n].questions[p].dataNode=f;p++;break;case"sum":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._total=parseInt(e[3]);if(trim(e[4])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[5]);f._referTopic=e[6];pageHolder[n].questions[p].dataNode=f;p++;break;case"radio":case"check":case"radio_down":case"matrix":f._type=trim(e[0]);f._topic=trim(e[1]);f._numperrow=trim(e[2]);if(e[3]=="true"){f._hasvalue=true;}else{f._hasvalue=false;}if(e[4]=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=e[5];f._mode=trim(e[9]);if(e[0]!="check"){if(e[6]=="true"){f._requir=true;}else{f._requir=false;}f.isSort=false;f.isRate=isRadioRate(f._mode);}else{var o=e[6].split(",");f._minValue=0;f._maxValue=0;if(o[0]=="true"){f._requir=true;}else{f._requir=false;}if(o[1]!=""){f._minValue=Number(o[1]);}if(o[2]!=""){f._maxValue=Number(o[2]);}f.isSort=f._mode!=""&&f._mode!="0";f.isRate=false;}if(e[7]=="true"){f._isTouPiao=true;}else{f._isTouPiao=false;}f._verify=trim(e[8]);f._referTopic=e[10];f._referedTopics=e[11];var c=12;f._select=new Array();for(var g=c;g<e.length;g++){f._select[g-c]=new Object();var b=e[g].split("〒");if(b[0]=="true"){f._select[g-c]._item_radio=true;}else{f._select[g-c]._item_radio=false;}f._select[g-c]._item_value=trim(b[1]);f._select[g-c]._item_jump=trim(b[2]);f._select[g-c]._item_huchi=b[3]=="true";if(f._select[g-c]._item_huchi){f.hasHuChi=true;}}pageHolder[n].questions[p].dataNode=f;p++;break;default:break;}}}function show_pre_page(){if(cur_page>0&&pageHolder[cur_page-1].hasExceedTime){alert("上一页填写超时，不能返回上一页");return;}submit_table.style.display="none";next_page.style.display="";pageHolder[cur_page].style.display="none";cur_page--;var f=window.isKaoShi;for(var c=cur_page;c>=0;c--){if(pageHolder[c].skipPage){cur_page--;}else{break;}}for(var c=cur_page;c>=0;c--){if(pageHolder[c].questions.length==0&&!f){break;}var a=pageHolder[c].questions;var e=false;for(var b=0;b<a.length;b++){var d=a[b];if(d.style.display!="none"){e=true;break;}}if(!e&&cur_page>0){cur_page--;}else{break;}}if(cur_page==0&&pre_page){pre_page.style.display="none";pre_page.disabled=true;}showDesc();pageHolder[cur_page].style.display="";var a=pageHolder[cur_page].questions;pageHolder[cur_page].scrollIntoView();postHeight();}var pubNoCheck=null;var saveNeedAlert=true;function checkDisalbed(){curdiv=null;if(!submit_button.disabled){return false;}if(divMinTime.innerHTML){var a=divMinTime.innerHTML.replace(/<.+?>/gim,"");alert(a);}return true;}function show_next_page(a){if(next_page){next_page.disabled=true;}curdiv=null;if(pubNoCheck!=true){if(a!=true&&!validate()){if(isPub&&pubNoCheck==null){if(window.confirm("您填写的数据不符合要求，由于您是发布者，可以选择直接跳到下一页（此次填写的答卷将不能提交），是否确定？")){pubNoCheck=true;document.getElementById("submittest_button").onclick=submit_button.onclick=function(){if(checkDisalbed()){return;}alert("由于您选择了跳过了数据检查，所以此次填写的答卷无法提交！如果您需要提交答卷，请刷新此页面并再次填写问卷。");};to_next_page();return;}else{pubNoCheck=false;next_page.disabled=false;return;}}else{next_page.disabled=false;return;}}}else{if(pubNoCheck==true){to_next_page();return;}}if(needSubmitNotValid&&isRunning=="true"&&a!=true){submit(3);}else{if(pageHolder[cur_page]._iszhenbie&&isRunning=="true"&&a!=true){submit(3);}else{to_next_page();if(a!=true&&allowSaveJoin&&isRunning=="true"&&guid){saveNeedAlert=false;submit(2);}}}}function to_next_page(){if(cur_page==0&&nextPageAlertText){alert(nextPageAlertText);}pre_page.style.display=displayPrevPage;pre_page.disabled=false;pageHolder[cur_page].style.display="none";cur_page++;next_page.disabled=false;for(var g=cur_page;g<pageHolder.length;g++){if(pageHolder[g].skipPage){cur_page++;}else{break;}}var k=false;var c=window.isKaoShi;for(var g=cur_page;g<pageHolder.length;g++){if(pageHolder[g].questions.length==0&&!k&&!c){if(pageHolder[g].cuts&&pageHolder[g].cuts.length>0){var b=false;for(var d=0;d<pageHolder[g].cuts.length;d++){if(pageHolder[g].cuts[d].style.display!="none"){b=true;break;}}if(!b&&cur_page<pageHolder.length-1){cur_page++;continue;}}break;}var h=pageHolder[g].questions;var f=false;for(var d=0;d<h.length;d++){var a=h[d];if(a.style.display!="none"){f=true;break;}}if(!f&&cur_page<pageHolder.length-1){cur_page++;k=true;}else{break;}}var e=true;for(var g=cur_page+1;g<pageHolder.length;g++){if(!pageHolder[g].skipPage){e=false;}}if(cur_page>=pageHolder.length-1||e){next_page.style.display="none";if(hasJoin!="1"){submit_table.style.display="";}}else{if(cur_page<pageHolder.length-1){next_page.style.display="";}}if(divMaxTime){divMaxTime.style.display="none";}showDesc();pageHolder[cur_page].style.display="";pageHolder[cur_page].scrollIntoView();showProgressBar();processMinMax();postHeight();}function showDesc(){if(!window.divDec){return;}var a=document.getElementById(window.divDec);if(a){a.style.display=cur_page>0?"none":"";}}if(hrefPreview){hrefPreview.onclick=function(){submit(0);return false;};}var spanSave=null;var saveInterval=null;var changeInterval=null;var totalSaveSec=1;if(hrefSave){hrefSave.onclick=function(){if(isRunning!="true"){alert("此问卷处于停止状态，不能保存！");return;}submit(2);return false;};if(isRunning=="true"){saveInterval=setInterval(function(){submit(2);},60000);}}var havereturn=false;var timeoutTimer=null;var errorTimes=0;var hasSendErrorMail=false;function processError(e,c,b,a){if(!havereturn){havereturn=true;var d="";var f=encodeURIComponent(e);if(f.length>1800){d=a+"&submitdata=exceed&partdata="+f.substring(0,1700);}else{d=a;if(a.indexOf("submitdata=")==-1){d+="&submitdata="+f;}if(a.indexOf("useget=")==-1){d+="&useget=1";}if(a.indexOf("iframe=")==-1){d+="&iframe=1";}}errorTimes++;if(errorTimes==1&&!hasSendErrorMail){d+="&nsd=1";hasSendErrorMail=true;}PDF_launch("/wjx/join/jqerror.aspx?"+d+"&status="+encodeURIComponent(c)+"&et="+errorTimes,400,120);refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";}prevsaveanswer="";if(!window.submitWithGet){window.submitWithGet=1;}if(timeoutTimer){clearTimeout(timeoutTimer);}}var prevsaveanswer="";function submit(n){if(n!=2&&!validate()){return;}if(n==1){if(window.isDianChu){if(!is_dianchecked){tou_submit.call(this);return false;}}else{if(tCode&&tCode.style.display!="none"&&(submit_text.value==""||submit_text.value==validate_info_submit_title3)){alert(validate_info_submit1);try{submit_text.focus();submit_text.click();}catch(v){}return false;}}}submit_tip.innerHTML=validate_info_submit2;var y=1;if(n==0){PromoteUser("正在处理，请稍候...",3000,true);}else{if(n==2){y=cur_page;}else{if(n==3){PromoteUser("正在验证，请稍候...",3000,true);}else{submit_tip.style.display="block";submit_div.style.display="none";}}}needCheckLeave=false;var h=sent_to_answer();if(n==2&&prevsaveanswer==h){var o="已保存";if(langVer==1){o="<div style='font-size:18px;'>&nbsp;&nbsp;Saved</div>";}if(spanSave){spanSave.innerHTML=o;}return;}var z=getXmlHttp();z.onreadystatechange=function(){if(z.readyState==4){clearTimeout(timeoutTimer);var e=z.status;if(e==200){afterSubmit(z.responseText,n);prevsaveanswer=h;}else{processError(h,e,n,m);}}};var m="submittype="+n+"&curID="+activityId+"&t="+(new Date()).valueOf();if(source){m+="&source="+encodeURIComponent(source);}if(window.udsid){m+="&udsid="+window.udsid;}if(nvvv){m+="&nvvv=1";}if(window.cProvince){m+="&cp="+encodeURIComponent(cProvince.replace("'",""))+"&cc="+encodeURIComponent(cCity.replace("'",""))+"&ci="+escape(cIp);if(jiFen==0){var l=cProvince+","+cCity;try{setCookie("ip_"+cIp,l,null,"/","",null);}catch(w){}}}if(hasTouPiao){m+="&toupiao=t";}if(jiFen>0){m+="&jf="+jiFen;}if(randomparm){m+="&ranparm="+randomparm;}if(inviteid){m+="&inviteid="+encodeURIComponent(inviteid);}if(SJBack){m+="&sjback=1";}if(eproguid){m+="&eproguid="+eproguid;}if(window.cpid){m+="&cpid="+cpid;}if(n==2){m+="&lastpage="+y+"&lastq="+MaxTopic;}if(n==3){m+="&zbp="+(cur_page+1);if(needSubmitNotValid){m+="&nsnv=1";}}if(hasJoin){m+="&nfjoinid="+nfjoinid;}if(window.sojumpParm){var t=window.sojumpParm;if(!window.hasEncode){t=encodeURIComponent(t);}m+="&sojumpparm="+t;}if(tCode&&tCode.style.display!="none"&&submit_text.value!=""){m+="&validate_text="+encodeURIComponent(submit_text.value);}if(window.isDianChu){m+="&check_key="+encodeURIComponent(check_key)+"&check_address="+encodeURIComponent(check_address)+"&validate_text=dian";}m+="&starttime="+encodeURIComponent(starttime);if(guid){m+="&emailguid="+guid;}if(window.sjUser){m+="&sjUser="+encodeURIComponent(sjUser);}if(window.mobileRnum){m+="&m="+window.mobileRnum;}if(window.rndnum){m+="&rn="+encodeURIComponent(rndnum);}if(Password){m+="&psd="+encodeURIComponent(Password);}if(hasMaxtime){m+="&hmt=1";}if(sourceDetail){m+="&sd="+sourceDetail;}if(imgVerify){m+="&btuserinput="+encodeURIComponent(submit_text.value);m+="&btcaptchaId="+encodeURIComponent(imgVerify.captchaId);m+="&btinstanceId="+encodeURIComponent(imgVerify.instanceId);}if(window.initMaxSurveyTime){m+="&mst="+window.initMaxSurveyTime;}var x=window.alipayAccount||window.cAlipayAccount;if(x){m+="&alac="+encodeURIComponent(x);}var p=encodeURIComponent(h);var i=false;var f="";var s="";for(var k=0;k<trapHolder.length;k++){f="";var c=trapHolder[k].itemInputs;var u=new Array();for(var r=0;r<c.length;r++){if(c[r].checked){u.push(c[r].value);}}u.sort(function(A,e){return A-e;});for(var r=0;r<u.length;r++){f+=u[r]+",";}var q=trapHolder[k].getAttribute("trapanswer");if(f&&q&&f.indexOf(q)==-1){i=true;s=trapHolder[k].getAttribute("tikuindex");break;}}if(i){m+="&ite=1&ics="+encodeURIComponent(s+";"+f);}var g=false;var b="post";var d=window.getMaxWidth||1800;if(window.submitWithGet&&p.length<=d){g=true;}if(g){m+="&submitdata="+p;m+="&useget=1";b="get";}else{if(window.submitWithGet){window.postIframe=1;}}var a="/handler/processjq.ashx?"+m;z.open(b,a,false);z.setRequestHeader("Content-Type","application/x-www-form-urlencoded");havereturn=false;if(window.postIframe){postWithIframe(a,h,n);}else{if(g){if(errorTimes==2||window.getWithIframe){GetWithIframe(a,h,n,m);}else{if(n==1){timeoutTimer=setTimeout(function(){processError(h,"ajaxget",n,m);},20000);}z.send(null);}}else{if(n==1){timeoutTimer=setTimeout(function(){processError(h,"ajaxpost",n,m);},20000);}z.send("submitdata="+p);}}}function postWithIframe(d,e,b,a){if(b==1){timeoutTimer=setTimeout(function(){processError(e,"postiframe",b,a);},20000);}var c=document.createElement("div");c.style.display="none";c.innerHTML="<iframe id='mainframe' name='mainframe' style='display:none;' > </iframe><form target='mainframe' id='frameform' action='' method='post' enctype='application/x-www-form-urlencoded'><input  value='' id='submitdata' name='submitdata' type='hidden'><input type='submit' value='提交' ></form>";document.body.appendChild(c);document.getElementById("submitdata").value=e;var f=document.getElementById("frameform");f.action=d+"&iframe=1";f.submit();}function GetWithIframe(d,e,b,a){if(b==1){timeoutTimer=setTimeout(function(){processError(e,"getiframe",b,a);},20000);}var c=document.createElement("div");c.style.display="none";var g=d+"&iframe=1";c.innerHTML="<iframe id='mainframe' name='mainframe'> </iframe>";document.body.appendChild(c);var f=document.getElementById("mainframe");f.src=g;}function getExpDate(d,a,c){var b=new Date();if(typeof(d)=="number"&&typeof(a)=="number"&&typeof(a)=="number"){b.setDate(b.getDate()+parseInt(d));b.setHours(b.getHours()+parseInt(a));b.setMinutes(b.getMinutes()+parseInt(c));return b.toGMTString();}}function processRedirect(k){var c=k[1];var b=k[3]||"";var g=k[2];var a=k[4]||"";if(!c||c[0]=="?"){c=window.location.href;}else{if(c.toLowerCase().indexOf("http://")==-1&&c.toLowerCase().indexOf("https://")==-1){c="http://"+c;}}var d=false;if(c.indexOf("{output}")>-1){if(window.sojumpParm){c=c.replace("{output}",sojumpParm);}else{if(a){c=c.replace("{output}",a);}}d=true;}if(window.sojumpParm||a){var f=b.split(",");var l="sojumpindex="+f[0];if(c.indexOf("?")>-1){l="&"+l;}else{l="?"+l;}if(f[1]){l+="&totalvalue="+f[1];}if(c.toLowerCase().indexOf("sojumpparm=")==-1&&!d&&window.sojumpParm){l+="&sojumpparm="+sojumpParm;}if(c.toLowerCase().indexOf("pingzheng=")==-1&&!d&&a){l+="&pingzheng="+a;}c+=l;}var i=1000;if(g&&g!="不提示"&&window.jiFenBao==0&&!window.sojumpParm){PromoteUser(g,5000,true);i=2000;}try{setCookie(activityId+"_save","",getExpDate(-1,0,0),"/","",null);}catch(h){}setTimeout(function(){location.replace(c);},i);}var changeSave=false;var nvvv=0;function afterSubmit(v,l){havereturn=true;errorTimes=0;if(document.getElementById("PDF_bg_chezchenz")){PDF_close();}clearTimeout(timeoutTimer);var m=v.split("〒");var k=m[0];if(l==0){if(k==14){var a=m[1];var q="/wjx/previewanswer.aspx?activityid="+activityId+"&sg="+a+"&t="+(new Date()).valueOf();PDF_launch(q,840,600);}else{alert("请点击预览答卷按钮");}}else{if(l==2){if(k==14){var a=m[1];var h=window.location.href.toLowerCase();if(h.indexOf("?")>-1){if(h.indexOf("sg=")>-1){h=h.replace(/sg=([\w|\-]+)/g,"sg="+a);}else{h=h+"&sg="+a;}}else{h=h+"?sg="+a;}if(hrefSave){var r=getTop(hrefSave);if(!spanSave){spanSave=document.createElement("div");divSaveText.appendChild(spanSave);spanSave.style.color="#666666";spanSave.style.lineHeight="14px";spanSave.style.width="14px";if(divProgressImg){divProgressImg.style.paddingLeft="7px";}else{spanSave.style.paddingLeft="15px";}}var u=new Date();var o=u.getMinutes();if(o<10){o="0"+o;}var b=u.getHours();if(b<10){b="0"+b;}var c=b+":"+o;spanSave.innerHTML="答卷保存于<div id='saveData'>1</div><div id='divUnit'>秒</div>钟前";if(langVer==1){spanSave.innerHTML="<div style='font-size:18px;'>&nbsp;&nbsp;Saved</div>";}totalSaveSec=1;spanSave.style.display="";submit_tip.style.display="none";clearInterval(changeInterval);changeInterval=setInterval(function(){var e=document.getElementById("saveData");if(e){totalSaveSec++;e.innerHTML=totalSaveSec;if(totalSaveSec>60){e.innerHTML=parseInt(totalSaveSec/60);document.getElementById("divUnit").innerHTML="分";}}},1000);}clearInterval(saveInterval);saveInterval=setInterval(function(){submit(2);},60000);if(!window.saveGuid){try{setCookie(activityId+"_save",a,getExpDate(30,0,0),"/","",null);}catch(t){}}if(m[2]){nfjoinid=m[2];hasJoin="2";}if(m[3]){starttime=m[3];}if(changeSave){var h=window.location.href;if(h.indexOf("?")==-1){h+="?csave=1";}else{h+="&csave=1";}window.location=h;}return;}}else{if(l==3){if(k==12){randomparm=m[1];PromoteUser("",1,true);to_next_page();return;}else{if(k==13){var f=m[1];var w=m[2]||"0";var h="/wjx/join/complete.aspx?q="+activityId+"&s="+simple+"&joinid="+f;if(guid){h+="&guid="+guid;}if(promoteSource=="t"){h+="&ps="+promoteSource;}if(eproguid){h+="&eproguid="+eproguid;}h+="&v="+w;if(window.sjUser){h+="&sjUser="+encodeURIComponent(sjUser);}location.replace(h);return;}else{if(k==11){processRedirect(m);return;}else{if(k==5){alert(m[1]);submit_tip.innerHTML=m[1];return;}}}}}else{if(k==10){var h=m[1];h+="&s="+simple;if(promoteSource=="t"){h+="&ps="+promoteSource;}if(eproguid){h+="&eproguid="+eproguid;}if(qwidth){h+="&width="+qwidth;}if(inviteid){h+="&inviteid="+inviteid;}if(source){h+="&source="+encodeURIComponent(source);}if(guid){h+="&guid="+guid;}if(window.sjUser){h+="&sjUser="+encodeURIComponent(sjUser);}if(window.needJQJiang){h+="&njqj=1";}if(window.HasJiFenBao){h+="&hjfb=1";}if(startAge){h+="&sa="+encodeURIComponent(startAge);}if(endAge){h+="&ea="+encodeURIComponent(endAge);}if(rName){h+="&rname="+encodeURIComponent(rName);}if(gender){h+="&ge="+gender;}if(marriage){h+="&ma="+marriage;}if(education){h+="&edu="+education;}if(shopHT.length>0){var n=document.getElementById("shopcart");if(n&&n.style.display!="none"){h+="&ishop=1";}}try{setCookie(activityId+"_save","",getExpDate(-1,0,0),"/","",null);}catch(t){}location.replace(h);return;}else{if(k==11){processRedirect(m);return;}else{if(k==9||k==16||k==23){var p=parseInt(m[1]);var d=(p+1)+"";var g=m[2]||"您提交的数据有误，请检查！";if(pageHolder.length==1&&pageHolder[0].questions[p]){writeError(pageHolder[0].questions[p],g,3000);pageHolder[0].questions[p].scrollIntoView();}else{if(questionsObject[d]){writeError(questionsObject[d],g,3000);alert(g);questionsObject[d].scrollIntoView();}else{alert("您提交的数据有误，请检查！");}}}else{if(k==7){alert(m[1]);if(needAvoidCrack!=2){tCode.style.display="";if(!needAvoidCrack){imgCode.style.display="";imgCode.onclick=refresh_validate;imgCode.onclick();}submit_tip.style.display="none";submit_div.style.display="block";try{submit_text.focus();submit_text.click();if(imgVerify){imgVerify.onclick();}}catch(s){}}}else{if(k==2){alert(m[1]);window.submitWithGet=1;}else{if(k==17){alert("密码冲突！在您提交答卷之前，此密码已经被另外一个用户使用了，请重新更换密码！\r\n系统会自动保存您当前填写的答卷，请复制新的链接重新提交此份答卷！");submit(2);return;}else{if(k==4){alert(m[1]);changeSave=true;submit(2);return;}else{if(k==5){alert(m[1]);submit_tip.innerHTML=m[1];return;}else{if(k==33){alert(m[1]);window.location.href=window.location.href;return;}else{if(k==34){alert("密码冲突！在您提交答卷之前，此密码已经被另外一个用户使用了，请更换密码重新填写问卷！");window.location.href=window.location.href;return;}else{if(k==19){alert(m[1]);window.location="/";return;}else{if(k==22){alert("提交有误，请输入验证码重新提交！");if(!needAvoidCrack){tCode.style.display="";imgCode.style.display="";imgCode.onclick=refresh_validate;imgCode.onclick();}nvvv=1;submit_tip.style.display="none";submit_div.style.display="block";return;}else{alert(m[1]);}}}}}}}}}}}}}}}refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";return;}var firstError=null;var firstMatrixError=null;var startAge=0;var endAge=0;var gender=0;var education=0;var marriage=0;var labelName="";var labelIndex=0;var rName="";function getAgeGenderLabel(d,a){if(d._type=="radio"&&a.itemInputs){for(var c=0;c<a.itemInputs.length;c++){if(a.itemInputs[c].checked){var b=getNextNode(a.itemInputs[c]);labelName=b.innerHTML;labelIndex=c;break;}}}else{if(d._type=="radio_down"){labelName=a.itemSel.options[a.itemSel.selectedIndex].text;labelIndex=a.itemSel.selectedIndex-1;}}}function getRname(c,a){if(rName){return;}if(c._type!="question"){return;}var d=a.divTitle.innerHTML;if(d.indexOf("姓名")==-1){return;}var b=a.itemTextarea||a.itemInputs[0];if(b){rName=b.value;}}function getAgeGender(c,a){if(c._type!="radio"&&c._type!="radio_down"){return;}var d=a.divTitle.innerHTML;if(d.indexOf("年龄")>-1){getAgeGenderLabel(c,a);if(!labelName){return;}var b=/[1-9][0-9]*/g;var e=labelName.match(b);if(!e||e.length==0){return;}if(e.length>2){return;}if(e.length==2){startAge=e[0];endAge=e[1];}else{if(e.length==1){if(labelIndex==0){endAge=e[0];}else{startAge=e[0];}}}}else{if(d.indexOf("性别")>-1){getAgeGenderLabel(c,a);if(!labelName){return;}if(labelName.indexOf("男")>-1){gender=1;}else{if(labelName.indexOf("女")>-1){gender=2;}}}else{if(d.indexOf("学历")>-1||d.indexOf("教育程度")>-1){getAgeGenderLabel(c,a);if(!labelName){return;}if(labelName.indexOf("初中")>-1){education=1;}else{if(labelName.indexOf("高中")>-1||labelName.indexOf("中专")>-1){education=2;}else{if(labelName.indexOf("大专")>-1){education=3;}else{if(labelName.indexOf("本科")>-1){education=4;}else{if(labelName.indexOf("硕士")>-1){education=5;}else{if(labelName.indexOf("博士")>-1){education=6;}}}}}}}else{if(d.indexOf("婚姻")>-1){getAgeGenderLabel(c,a);if(!labelName){return;}if(labelName.indexOf("已婚")>-1){marriage=1;}else{if(labelName.indexOf("未婚")>-1){marriage=2;}else{if(labelName.indexOf("离婚")>-1){marriage=3;}else{if(labelName.indexOf("再婚")>-1){marriage=4;}}}}}}}}}function sent_to_answer(){var u=new Array();var z=0;for(var w=0;w<pageHolder.length;w++){var aa=pageHolder[w].questions;var r=pageHolder[w]._maxtime>0;for(var Z=0;Z<aa.length;Z++){var G=aa[Z].dataNode;var p=aa[Z].style.display.toLowerCase()=="none"||(aa[Z].dataNode._referTopic&&!aa[Z].displayContent&&!window.cepingCandidate)||pageHolder[w].skipPage;if(aa[Z].isCepingQ){p=false;}var q=new Object();q._topic=G._topic;q._value="";u[z++]=q;try{getAgeGender(G,aa[Z]);getRname(G,aa[Z]);}catch(Q){}switch(G._type){case"question":if(p){q._value="(跳过)";if(aa[Z].getAttribute("hrq")=="1"){q._value="Ⅳ";}continue;}var R=aa[Z].itemTextarea||aa[Z].itemInputs[0];var A=R.value||"";if(A&&R.lnglat){A=A+"["+R.lnglat+"]";}q._value=replace_specialChar(A);break;case"gapfill":if(p){if(aa[Z].getAttribute("hrq")=="1"){q._value="Ⅳ";continue;}}var f=aa[Z].gapFills;for(var W=0;W<f.length;W++){if(W>0){q._value+=spChars[2];}if(p){q._value+="(跳过)";}else{var A=trim(f[W].value.substring(0,3000));if(A&&f[W].lnglat){A=A+"["+f[W].lnglat+"]";}q._value+=replace_specialChar(A);}}break;case"slider":var S=aa[Z].divSlider.value;if(p){q._value="(跳过)";continue;}q._value=S==undefined?"":S;break;case"fileupload":var E=aa[Z].fileName;if(p){q._value="(跳过)";continue;}q._value=E||"";break;case"sum":var x=aa[Z].itemInputs;len=x.length;for(var W=0;W<len;W++){var M=x[W];var N=aa[Z].relSum==0?trim(M.value)||"0":trim(M.value);if(aa[Z].itemTrs[W].style.display=="none"){N="Ⅳ";}if(W>0){q._value+=spChars[2];}var s=aa[Z].itemTrs[W].getAttribute("rowid");if(s){q._value+=s+spChars[4];}q._value+=N;}if(p){var U=0;while(U<len){if(U==0){q._value="(跳过)";}else{q._value+=spChars[2]+"(跳过)";}U++;}}break;case"radio":case"check":if(aa[Z].itemSel){var ab=aa[Z].itemSel;var D=ab.options;if(p){var U=0;while(U<G._select.length){if(U==0){q._value="-3";}else{q._value+=",-3";}U++;}continue;}for(var W=0;W<D.length;W++){if(W==0){q._value=D[W].value+"";}else{q._value+=","+D[W].value;}}if(D.length==0||D.length<G._select.length){var L=G._select.length;for(var W=D.length;W<L;W++){if(q._value){q._value+=",-2";}else{q._value="-2";}}}continue;}if(p){q._value="-3";if(aa[Z].getAttribute("hrq")=="1"){q._value="-4";}continue;}var D=aa[Z].itemInputs||aa[Z].itemLis;if(aa[Z].isShop){var I=false;for(var W=0;W<D.length;W++){var F=parseInt(D[W].value);if(F>0){if(q._value){q._value+=spChars[3];}q._value+=(W+1)+"";q._value+=spChars[2]+F;I=true;}}if(!I){q._value="-2";}continue;}var y=-1;var O=0;for(var W=0;W<D.length;W++){if(D[W].className.toLowerCase().indexOf("on")>-1){y=W;}var B=D[W].parentNode&&D[W].parentNode.style.display=="none";if(!B&&D[W].checked){O++;if(q._value){q._value+=spChars[3]+D[W].value;}else{q._value=D[W].value+"";}if(D[W].itemText){var X=D[W].itemText.value;if(X==defaultOtherText){X="";}q._value+=spChars[2]+replace_specialChar(trim(X.substring(0,3000)));}}}if(y>-1){q._value=D[y].value+"";}else{if(O>0){}else{q._value="-2";}}break;case"radio_down":if(p){q._value="-3";continue;}q._value=aa[Z].itemSel.value;break;case"matrix":var l=aa[Z].itemTrs;var m=G._mode;len=l.length;var ac=0;var o=0;var K=0;var C=0;var T=new Array();var h=false;for(var W=0;W<l.length;W++){var c=l[W].getAttribute("rindex");if(c==0&&l[W].getAttribute("randomrow")=="true"){h=true;}var ae=new Object();ae.rIndex=parseInt(c);var b=m!="201"&&m!="202"&&m!="301"&&m!="302"&&m!="303";if(l[W].style.display=="none"){if(b){var d="-4";if(q._value){q._value+=","+d;}else{q._value=d;}ae.val=d;continue;}}var D=l[W].itemInputs||l[W].itemLis||l[W].divSlider||l[W].itemSels;if(!D){len=len-1;C=1;continue;}else{ac=D.length;}var y=-1;var J="";if(m!="201"&&m!="202"){for(var U=0;U<D.length;U++){if(D[U].className.toLowerCase().indexOf("on")>-1){y=U;J=D[U].value;}if(D[U].checked){y=U;if(J){J+=";"+D[U].value;}else{J=D[U].value;}if((m=="103"||m=="102"||m=="101")){var ad=D[U].getAttribute("needfill");if(ad){var Y=D[U].fillvalue||D[U].getAttribute("fillvalue")||"";if(Y==defaultOtherText){Y="";}Y=replace_specialChar(Y).replace(/;/g,"；").replace(/,/g,"，");J+=spChars[2]+Y;}}}else{if(D[U].tagName=="TEXTAREA"||D[U].tagName=="SELECT"){y=U;var Y=trim(D[U].value);if(l[W].style.display=="none"){Y="Ⅳ";}if(U>0){J+=spChars[3];}if(Y){if(m=="302"){if(Y&&D[U].lnglat){Y=Y+"["+D[U].lnglat+"]";}Y=replace_specialChar(Y);}J+=Y;}else{if(m=="303"){J+="-2";}else{J+="(空)";}}}}}if(y>-1){if(q._value){if(m=="301"||m=="302"||m=="303"){q._value+=spChars[2]+J;}else{q._value+=","+J;}}else{q._value=J;}ae.val=J;}else{if(q._value){q._value+=",-2";}else{q._value="-2";}ae.val="-2";}}else{if(m=="201"){var F=trim(D[0].value.substring(0,3000));if(l[W].style.display=="none"){F="Ⅳ";}if(F&&D[0].lnglat){F=F+"["+D[0].lnglat+"]";}if(K>0){q._value+=spChars[2]+replace_specialChar(F);}else{q._value=replace_specialChar(F);}ae.val=replace_specialChar(F);}else{if(m=="202"){var V=l[W].divSlider.value==undefined?"":l[W].divSlider.value;if(l[W].style.display=="none"){V="Ⅳ";}if(K>0){q._value+=spChars[2]+V;}else{q._value=V;}ae.val=V;}}}T.push(ae);K++;}if(p){var U=0;q._value="";while(U<len){if(m=="201"||m=="202"){if(U==0){q._value="(跳过)";}else{q._value+=spChars[2]+"(跳过)";}}else{if(m=="301"||m=="302"||m=="303"){if(U>0){q._value+=spChars[2];}for(var H=0;H<ac;H++){if(H>0){q._value+=spChars[3];}if(m=="303"){q._value+="-3";}else{q._value+="(跳过)";}}}else{if(U==0){q._value="-3";}else{q._value+=",-3";}}}U++;}continue;}else{T.sort(function(k,i){return k.rIndex-i.rIndex;});var e=spChars[2];if(m!="201"&&m!="202"&&m!="301"&&m!="302"&&m!="303"){e=",";}var P="";for(var a=0;a<T.length;a++){if(a>0){P+=e;}var n=T[a].rIndex;if(parseInt(n)==n){var c=parseInt(n)+1;P+=c+spChars[4];}P+=T[a].val;}q._value=P;}break;}}}u.sort(function(k,i){return k._topic-i._topic;});var g="";for(Z=0;Z<u.length;Z++){if(Z>0){g+=spChars[1];}g+=u[Z]._topic;g+=spChars[0];g+=u[Z]._value;}return g;}var verifyMsg="";var needSubmitNotValid=false;function validate(){var A=true;needSubmitNotValid=false;var S=pageHolder[cur_page].questions;var C=pageHolder[cur_page].hasExceedTime;firstError=null;firstMatrixError=null;curMatrixError=null;var U=document.getElementById("divNA");var J=U.getElementsByTagName("input");if(J[0].checked||J[1].checked){alert("系统检测到非法填写问卷");window.location.href=window.location.href;return;}for(var R=0;R<S.length;R++){var y=S[R].dataNode;var V=y._hasjump;verifyMsg="";var u=S[R].style.display.toLowerCase()=="none"||pageHolder[cur_page].skipPage;if(S[R].removeError){S[R].removeError();}if(u||(S[R].dataNode._referTopic&&!S[R].displayContent&&!window.cepingCandidate)||C){continue;}switch(y._type){case"question":var I=S[R].itemTextarea||S[R].itemInputs[0];var q=I.value||"";if(y._requir){if(trim(q)==""){A=writeError(S[R],validate_info_q1,3000);}}if(S[R].needsms&&q&&!S[R].issmsvalid){A=writeError(S[R],"提示：您的手机号码没有通过验证，请先验证",3000);}if(q.length-3000>0){A=writeError(S[R],"您输入的字数超过了3000，请修改！",3000);}var o=y._verify;var K=S[R].getAttribute("issample");var F=true;if(K&&promoteSource!="t"){F=false;}if(F){if(q){var H=verifyMinMax(I,o,y._minword,y._maxword);if(H!=""){A=writeError(S[R],H,3000);}}if(q!=""&&o&&o!="0"){var H=verifydata(I,o,y);if(H!=""){A=writeError(S[R],H,3000);}}}if(A&&trim(q)!=""&&isRunning=="true"){if(y._needOnly){if(I.isOnly==false){A=writeError(S[R],validate_only,3000);}else{if(I.isOnly!=true&&y._verify!="地图"){A=writeError(S[R],validate_error,3000);I.focus();return A;}}}if(A&&y._hasList&&y._listId!=-1){if(I.isInList==false){A=writeError(S[R],validate_list,3000);}else{if(I.isInList!=true){A=writeError(S[R],validate_error,3000);I.focus();return A;}}}}if(V){jumpAnyChoice(S[R],true);}break;case"gapfill":var c=S[R].gapFills;for(var P=0;P<c.length;P++){var q=c[P].value||"";if(trim(q)==""){if(y._requir&&c[P].getAttribute("isrequir")!="0"){S[R].errorControl=c[P];A=writeError(S[R],validate_info_q1,3000);break;}}else{var O=0;O=validateMatrix(y,c[P],c[P]);if(O){S[R].errorControl=c[P];A=writeError(S[R],verifyMsg,3000);break;}}}break;case"slider":var L=S[R].divSlider.value;if(y._requir&&L==undefined){A=writeError(S[R],validate_info_wd1,3000);}if(V){jumpAnyChoice(S[R],true);}break;case"fileupload":if(y._requir&&!S[R].fileName){A=writeError(S[R],validate_info_f1,3000);}if(V){jumpAnyChoice(S[R],true);}break;case"sum":var M=S[R].sumLeft;if(M==0){var n=S[R].getElementsByTagName("input");M=S[R].dataNode._total;for(var z=0;z<n.length;z++){var x=n[z];var W=S[R].itemTrs[z];if(W.style.display!="none"){M=M-parseInt(x.value);}}}if(y._requir){if(M!=0){A=false;if(!M){M=100;}if(!firstError){firstError=S[R];}var H="<span style='color:red;'>"+sum_warn+"</span>";if(S[R].relSum){S[R].relSum.innerHTML=sum_total+"<b>"+y._total+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(y._total-M)+"</span>，"+H;}}}else{if(M!=undefined&&M!=0){A=false;if(!firstError){firstError=S[R];}var H="<span style='color:red;'>"+sum_warn+"</span>";if(S[R].relSum){S[R].relSum.innerHTML=sum_total+"<b>"+y._total+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(y._total-M)+"</span>，"+H;}}}if(V){jumpAnyChoice(S[R],true);}break;case"radio":case"check":if(S[R].itemSel){var T=S[R].itemSel;var v=T.options;if(v.length==0&&y._requir){A=writeError(S[R],validate_info_o1,3000);}else{if(v.length>0){if((y._minValue==0||y._minValue==y._select.length)&&v.length!=y._select.length){A=writeError(S[R],validate_info+validate_info_check3,3000);}else{if(y._maxValue>0&&v.length>y._maxValue){var E=validate_info+validate_info_check1+y._maxValue+validate_info_check2;if(langVer==0){E+=",您多选择了"+(v.length-y._maxValue)+"项";}A=writeError(S[R],E,3000);}else{if(y._minValue>0&&v.length<y._minValue){var E=validate_info+validate_info_check1+y._minValue+validate_info_check2;if(langVer==0){E+=",您少选择了"+(y._minValue-v.length)+"项";}A=writeError(S[R],E,3000);}}}}}if(V){jumpAnyChoice(S[R],true);}continue;}var v=S[R].itemInputs||S[R].itemLis;var p=-1;var G=0;var g=-1;for(var P=0;P<v.length;P++){if(v[P].className.toLowerCase().indexOf("on")>-1){p=P;g=P;}if(v[P].checked){G++;g=P;if(y._type=="radio"){if(V&&y._select[v[g].value-1]&&y._select[v[g].value-1]._item_jump==-1){needSubmitNotValid=true;}}if(v[P].req&&isTextBoxEmpty(v[P].itemText.value)){A=writeError(S[R],validate_textbox,3000);}}}if(p>-1){hasChoice=true;}else{if(G>0){hasChoice=true;if(y._maxValue>0&&G>y._maxValue){var E=validate_info+validate_info_check4+y._maxValue+type_check_limit5;if(langVer==0){E+=",您多选择了"+(G-y._maxValue)+"项";}A=writeError(S[R],E,3000);}else{if(y._minValue>0&&G<y._minValue){var E=validate_info+validate_info_check5+y._minValue+type_check_limit5;if(langVer==0){E+=",您少选择了"+(y._minValue-G)+"项";}if(G==1&&y._select[g]&&y._select[g]._item_huchi){E="";}else{A=writeError(S[R],E,3000);}}}}else{if(y._requir){A=writeError(S[R],validate_info_c1,3000);}}}if(V){if(y._type=="radio"&&y._anytimejumpto<1){if(g>-1){processJ(S[R].indexInPage-0,y._select[v[g].value-1]._item_jump-0,true);}else{processJ(S[R].indexInPage-0,0,true);}}else{jumpAnyChoice(S[R],true);}}break;case"radio_down":if(y._requir&&S[R].itemSel.selectedIndex==0){A=writeError(S[R],validate_info_c1,3000);}if(V){if(S[R].itemSel.selectedIndex>0&&y._select[S[R].itemSel.value-1]&&y._select[S[R].itemSel.value-1]._item_jump==-1){needSubmitNotValid=true;}if(y._anytimejumpto<1){if(S[R].itemSel.selectedIndex==0){processJ(S[R].indexInPage-0,0,true);}else{processJ(S[R].indexInPage-0,y._select[S[R].itemSel.value-1]._item_jump-0,true);}}else{jumpAnyChoice(S[R],true);}}break;case"matrix":var e=S[R].itemTrs;var h=y._mode;len=e.length;var l=0;var d=0;var O=0;var w;for(var P=0;P<e.length;P++){if(e[P].style.display=="none"){len=len-1;continue;}var v=e[P].itemInputs||e[P].itemLis||e[P].divSlider||e[P].itemSels;if(!v){len=len-1;continue;}var p=-1;var G=0;if(h!="201"&&h!="202"){for(var N=0;N<v.length;N++){if(v[N].className.toLowerCase().indexOf("on")>-1){p=N;}else{if(v[N].checked){p=N;G++;if((h=="103"||h=="102"||h=="101")){var X=v[N].getAttribute("needfill");var D=v[N].getAttribute("req");if(X&&D){var b=v[N].fillvalue||v[N].getAttribute("fillvalue")||"";if(isTextBoxEmpty(b)){verifyMsg=validate_textbox;O=1;if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}showMatrixFill(v[N],1);break;}}}}else{if(v[N].tagName=="TEXTAREA"||v[N].tagName=="SELECT"){var Q=trim(v[N].value);p=N;if(!Q){var r=v[N].parentNode;if(h=="303"){if(r.style.display!="none"){p=-1;break;}}else{if(r.style.display!="none"){p=-1;if(h=="301"&&y._requir){d=1;if(!w){w=v[N];}if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}}break;}}}else{if(h=="301"){Q=DBC2SBC(v[N]);if(y._verify=="数字"&&parseInt(Q)!=Q){d=1;}else{if(y._verify=="小数"&&!/^(\-)?\d+(\.\d+)?$/.exec(Q)){d=1;}else{if((y._minvalue&&parseInt(Q)-parseInt(y._minvalue)<0)||(y._maxvalue&&parseInt(Q)-parseInt(y._maxvalue)>0)){d=2;}}}if(d){if(!w){w=v[N];}if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}}}else{if(h=="302"){O=validateMatrix(y,v[N],v[N]);if(O){if(!w){w=v[N];}if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}break;}}}}}}}}if(h=="102"){if(p>-1){var a=false;if(y._maxvalue>0&&G>y._maxvalue){var E=validate_info+validate_info_check4+y._maxvalue+type_check_limit5;if(langVer==0){E+=",您多选择了"+(G-y._maxvalue)+"项";}verifyMsg=E;O=1;if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}}else{if(y._minvalue>0&&G<y._minvalue){var E=validate_info+validate_info_check5+y._minvalue+type_check_limit5;if(langVer==0){E+=",您少选择了"+(y._minvalue-G)+"项";}verifyMsg=E;O=1;if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}}}}}}else{if(h=="201"){if(!O){O=validateMatrix(y,e[P],v[0]);}if(O){if(!w){w=v[0];}if(!firstMatrixError){firstMatrixError=S[R].itemTrs[P];}}if(trim(v[0].value)!=""){p=0;}else{if(e[P].getAttribute("isrequir")=="0"){p=0;}}}else{if(h=="202"){if(e[P].divSlider.value!=undefined){p=0;}}}}if(p>-1){l++;}else{if(y._requir){break;}}}if(y._requir&&l<len){A=writeError(S[R],validate_info+validate_info_matrix2+validate_info_matrix1+(l+1)+validate_info_matrix3,3000);if(S[R].itemTrs[P]&&!firstMatrixError){firstMatrixError=S[R].itemTrs[P];var f=S[R].getAttribute("DaoZhi");if(!f){S[R].itemTrs[P].onclick();}}}if((h=="201"||h=="302")&&O){if(w){S[R].errorControl=w;}A=writeError(S[R],verifyMsg,3000);if(firstMatrixError){firstMatrixError.onclick();}}if((h=="102"||h=="103"||h=="101")&&O){if(w){S[R].errorControl=w;}A=writeError(S[R],verifyMsg,3000);if(firstMatrixError){firstMatrixError.onclick();}}if(h=="301"&&d){var s="";if(d==2){if(y._minvalue){s+=","+type_wd_minlimitDigit+":"+y._minvalue;}if(y._maxvalue){s+=","+type_wd_maxlimitDigit+":"+y._maxvalue;}}if(w){S[R].errorControl=w;}A=writeError(S[R],validate_info+validate_info_matrix4+s,3000);if(firstMatrixError){firstMatrixError.onclick();}}if(V){jumpAnyChoice(S[R],true);}break;}}for(var B=0;B<trapHolder.length;B++){if(trapHolder[B].pageIndex!=cur_page+1){continue;}var v=trapHolder[B].itemInputs;var m="";for(var P=0;P<v.length;P++){if(v[P].checked){m+=v[P].value+",";}}if(!m){A=writeError(trapHolder[B],validate_info_wd1,3000);break;}}if(firstError){PromoteUser(validate_submit,3000,false);if(firstMatrixError&&firstMatrixError.parent==firstError){firstMatrixError.scrollIntoView();}else{firstError.scrollIntoView();}}return A;}function validateMatrix(i,b,f){var d=0;if(!f.value){return d;}var h=f.value;var a=b.getAttribute("itemverify")||"";var g=b.getAttribute("minword")||"";var c=b.getAttribute("maxword")||"";var k=b.getAttribute("issample");var e=true;verifyMsg="";if(k&&promoteSource!="t"){e=false;}if(e){verifyMsg=verifyMinMax(f,a,g,c);}if(verifyMsg!=""){d=1;}if(e&&d==0&&a&&a!="0"){verifyMsg=verifydata(f,a,i);if(verifyMsg!=""){d=2;}}return d;}function removeError(){if(this.errorMessage){this.errorMessage.innerHTML="";this.removeError=null;this.style.border="solid 2px white";if(this.errorControl){this.errorControl.style.background="white";this.errorControl=null;}}}function PromoteUser(c,b,a){if(!a){alert(c);}else{show_status_tip(c,b);}}function writeError(e,g,f,b){if(e.errorMessage&&e.errorMessage.innerHTML!=""){return;}if(e.dataNode&&((e.dataNode._type=="matrix"&&e.dataNode._mode=="202")||e.dataNode._type=="slider")){}else{if(!b){e.style.border="solid 2px #ff9900";}}if(!e.errorMessage){var d=$$("div",e);for(var c=0;c<d.length;c++){var a=d[c].className.toLowerCase();if(a=="errormessage"){e.errorMessage=d[c];break;}}}if(!e.errorMessage){return;}e.errorMessage.innerHTML=g;e.removeError=removeError;if(e.errorControl){e.errorControl.style.background="#FBD5B5";}if(!firstError){firstError=e;}return false;}function show_status_tip(a,b){submit_tip.style.display="block";submit_tip.innerHTML=a;if(b>0){setTimeout("submit_tip.style.display='none'",b);}}function isDate(c){var a=new Array();if(c.indexOf("-")!=-1){a=c.toString().split("-");}else{if(c.indexOf("/")!=-1){a=c.toString().split("/");}else{return false;}}if(a[0].length==4){var b=new Date(a[0],a[1]-1,a[2]);if(b.getFullYear()==a[0]&&b.getMonth()==a[1]-1&&b.getDate()==a[2]){return true;}}return false;}function DBC2SBC(b){var c=b.value;var a=c.dbc2sbc();if(c!=a){b.value=a;}return b.value;}//function verifydata(f,d,e){var c=f.value;var a=null;if(d.toLowerCase()=="email"||d.toLowerCase()=="msn"){a=/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i;if(!a.exec(c)){return validate_email;}else{return"";}}else{if(d=="日期"||d=="生日"||d=="入学时间"){if(!isDate(c)){return validate_date;}else{return"";}}else{if(d=="固话"){c=DBC2SBC(f);a=/^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$/;if(!a.exec(c)){return validate_phone;}else{return"";}}else{if(d=="手机"){c=DBC2SBC(f);a=/^\d{11}$/;if(!a.exec(c)){return validate_mobile;}else{return"";}}else{if(d=="电话"){a=/(^\d{11}$)|(^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$)/;if(!a.exec(c)){return validate_mo_phone;}else{return"";}}else{if(d=="汉字"){a=/^[\u4e00-\u9fa5]+$/;if(!a.exec(c)){return validate_chinese;}else{return"";}}else{if(d=="姓名"){a=/^[\u4e00-\u9fa5]{2,4}$/;if(!a.exec(c)){return"姓名必须为2到4个汉字";}else{return"";}}else{if(d=="英文"){a=/^[A-Za-z]+$/;if(!a.exec(c)){return validate_english;}else{return"";}}else{if(d=="网址"||d=="公司网址"){a=/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;if(!a.exec(c)){return validate_reticulation;}else{return"";}}else{if(d=="身份证号"){c=DBC2SBC(f);a=/^\d{15}(\d{2}[A-Za-z0-9])?$/;if(!a.exec(c)){return validate_idcardNum;}else{return"";}}else{if(d=="学号"){c=DBC2SBC(f);a=/^\d+$/;if(!a.exec(c)){return validate_num.replace("，请注意使用英文字符格式","");}}else{if(d=="数字"){c=DBC2SBC(f);a=/^(\-)?\d+$/;if(!a.exec(c)){return validate_num;}}else{if(d=="小数"){c=DBC2SBC(f);a=/^(\-)?\d+(\.\d+)?$/;if(!a.exec(c)){return validate_decnum;}}else{if(d.toLowerCase()=="qq"){c=DBC2SBC(f);a=/^\d+$/;var b=/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/;if(!a.exec(c)&&!b.exec(c)){return validate_qq;}else{return"";}}}}}}}}}}}}}}}return"";}function verifyMinMax(f,e,c,a){var d=f.value;if(e=="数字"||e=="小数"){if(!afterDigitPublish){return"";}d=DBC2SBC(f);var b=/^(\-)?\d+$/;if(e=="小数"){b=/^(\-)?\d+(\.\d+)?$/;}if(!b.exec(d)){if(e=="小数"){return validate_decnum;}else{return validate_num;}}if(d!=0){d=d.replace(/^0+/,"");}if(c!=""){if(e=="数字"&&parseInt(d)-parseInt(c)<0){return validate_num2+c;}else{if(e=="小数"&&parseFloat(d)-parseFloat(c)<0){return validate_num2+c;}}}if(a!=""){if(e=="数字"&&parseInt(d)-parseInt(a)>0){return validate_num1+a;}else{if(e=="小数"&&parseFloat(d)-parseFloat(a)>0){return validate_num1+a;}}}}else{if(a!=""&&d.length-a>0){return validate_info_wd3.format(a,d.length);}if(c!=""&&d.length-c<0){return validate_info_wd4.format(c,d.length);}}return"";}function getXmlHttp(){var a;try{a=new ActiveXObject("Msxml2.XMLHTTP");}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP");}catch(b){try{a=new XMLHttpRequest();}catch(b){}}}return a;}if(nv==1){var ii=cur_page;for(;ii<totalPage;ii++){if(validate()){to_next_page();}else{break;}}}function postHeight(){if(window==window.top){return;}try{var b=parent.postMessage?parent:parent.document.postMessage?parent.document:null;if(b!=null){b.postMessage("heightChanged,"+((document.documentElement.scrollHeight||document.body.scrollHeight)+50),"*");}}catch(a){}}postHeight();